(function(t){function e(e){for(var a,l,n=e[0],r=e[1],c=e[2],f=0,h=[];f<n.length;f++)l=n[f],Object.prototype.hasOwnProperty.call(i,l)&&i[l]&&h.push(i[l][0]),i[l]=0;for(a in r)Object.prototype.hasOwnProperty.call(r,a)&&(t[a]=r[a]);d&&d(e);while(h.length)h.shift()();return o.push.apply(o,c||[]),s()}function s(){for(var t,e=0;e<o.length;e++){for(var s=o[e],a=!0,n=1;n<s.length;n++){var r=s[n];0!==i[r]&&(a=!1)}a&&(o.splice(e--,1),t=l(l.s=s[0]))}return t}var a={},i={app:0},o=[];function l(e){if(a[e])return a[e].exports;var s=a[e]={i:e,l:!1,exports:{}};return t[e].call(s.exports,s,s.exports,l),s.l=!0,s.exports}l.m=t,l.c=a,l.d=function(t,e,s){l.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},l.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},l.t=function(t,e){if(1&e&&(t=l(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(l.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)l.d(s,a,function(e){return t[e]}.bind(null,a));return s},l.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return l.d(e,"a",e),e},l.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},l.p="/protein_prediction/";var n=window["webpackJsonp"]=window["webpackJsonp"]||[],r=n.push.bind(n);n.push=e,n=n.slice();for(var c=0;c<n.length;c++)e(n[c]);var d=r;o.push([0,"chunk-vendors"]),s()})({0:function(t,e,s){t.exports=s("56d7")},"22fa":function(t,e,s){"use strict";s("cfdc")},"311e":function(t,e,s){"use strict";s("6e0a")},"56d7":function(t,e,s){"use strict";s.r(e);var a=s("2b0e"),i=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"app"}},[t._m(0),e("div",{staticClass:"main-container"},[e("div",{staticClass:"sidebar"},[e("button",{class:{active:"GeneVisualization"===t.currentPage},on:{click:function(e){return t.showPage("GeneVisualization")}}},[e("i",{staticClass:"fa-solid fa-flask-vial"}),t._v(" 基因组注释 ")]),e("button",{class:{active:"SummaryReport"===t.currentPage},on:{click:function(e){return t.showPage("SummaryReport")}}},[e("i",{staticClass:"fa-solid fa-folder-open"}),t._v(" 总报告管理 ")]),e("button",{class:{active:"ModelTrain"===t.currentPage},on:{click:function(e){return t.showPage("ModelTrain")}}},[e("i",{staticClass:"fa-solid fa-folder-open"}),t._v(" 模型训练 ")]),e("button",{class:{active:"ModelManage"===t.currentPage},on:{click:function(e){return t.showPage("ModelManage")}}},[e("i",{staticClass:"fa-solid fa-folder-open"}),t._v(" 模型管理 ")]),e("button",{class:{active:"KnowledgeManage"===t.currentPage},on:{click:function(e){return t.showPage("KnowledgeManage")}}},[e("i",{staticClass:"fa-solid fa-brain"}),t._v(" 知识库管理 ")])]),e("div",{staticClass:"content"},[e("transition",{attrs:{name:"fade",mode:"out-in"}},[e(t.currentPage,{tag:"component"})],1)],1)])])},o=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"header"},[e("h1",[t._v("Virgenta")]),e("p",[t._v("基于HyperFusion cortex(HFC)的轻量病毒基因组注释系统-高效解析泛基因组非核心基因突变")]),e("p",[t._v("全自动预测病毒基因中的蛋白质序列并生成报告")])])}],l=function(){var t=this,e=t._self._c;return e("div",{staticClass:"container"},[e("div",{staticClass:"header-section"},[t._m(0),e("div",{staticClass:"file-upload-container"},[e("label",{staticClass:"file-upload-button"},[e("input",{ref:"fileInput",attrs:{type:"file",accept:".fasta"},on:{change:t.handleFileUpload}}),t.isUploading||t.uploadError?t._e():e("span",[e("i",{staticClass:"icon-upload"}),t._v(" "+t._s(t.fileName||"选择FASTA文件")+" ")]),t.isUploading?e("span",{staticClass:"uploading-text"},[e("i",{staticClass:"fa-solid fa-spinner fa-spin"}),t._v(" 正在分析中... ")]):t._e(),t.uploadError?e("span",{staticClass:"error-text"},[e("i",{staticClass:"fa-solid fa-exclamation-triangle"}),t._v(" "+t._s(t.uploadError)+" ")]):t._e()]),t.isUploading?e("div",{staticClass:"progress-container"},[e("div",{staticClass:"progress-bar",style:{width:t.progress+"%"}}),e("span",{staticClass:"progress-text"},[t._v(t._s(t.progress)+"%")])]):t._e()]),e("div",{staticClass:"model-select-container"},[e("label",{staticClass:"model-select-label"},[t._v("选择模型：")]),e("select",{directives:[{name:"model",rawName:"v-model",value:t.selectedModelFile,expression:"selectedModelFile"}],staticClass:"model-select",on:{change:function(e){var s=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.selectedModelFile=e.target.multiple?s:s[0]}}},t._l(t.modelOptions,(function(s){return e("option",{key:s.value,domProps:{value:s.value}},[t._v(" "+t._s(s.label)+" ")])})),0)])]),t.geneData?e("div",[t._m(1),e("div",{staticClass:"search-button-container"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.searchKeyword,expression:"searchKeyword"}],attrs:{type:"text",placeholder:"按蛋白类型搜索"},domProps:{value:t.searchKeyword},on:{input:[function(e){e.target.composing||(t.searchKeyword=e.target.value)},t.filterGenes]}}),e("div",{staticClass:"control-buttons"},[e("button",{attrs:{disabled:t.isUploading||!t.currentReport},on:{click:t.showReportModal}},[e("i",{staticClass:"fa-solid fa-table-list"}),t._v(" 查看txt报告 ")]),e("button",{on:{click:t.openGffReportModal}},[e("i",{staticClass:"fa-solid fa-file-alt"}),t._v(" 查看GFF报告 ")]),e("button",{on:{click:t.clearDetection}},[e("i",{staticClass:"fa-solid fa-power-off"}),t._v(" 关闭预测 ")])])]),e("div",{staticClass:"gene-visualization-wrapper"},[e("div",{ref:"rulerContainer",staticClass:"ruler-container",on:{mousemove:t.handleRulerHover,mouseleave:t.handleRulerLeave}},[e("canvas",{ref:"rulerCanvas",staticClass:"ruler-canvas"}),e("div",{staticClass:"gene-length-bar",style:{width:t.getScaledWidth(t.geneData.metadata.length)+"px"}}),t.showRulerTooltip?e("div",{staticClass:"ruler-tooltip",style:{left:t.rulerTooltipPos+"px"}},[t._v(" "+t._s(t.rulerTooltipText)+" ")]):t._e(),t.showRulerLine?e("div",{staticClass:"ruler-line",style:{left:t.rulerTooltipPos+"px"}}):t._e(),e("div",{ref:"geneRowsContainer",staticClass:"gene-rows-container",on:{scroll:t.handleScroll}},t._l(t.filteredGeneRows,(function(s,a){return e("div",{key:a,staticClass:"gene-row"},t._l(s,(function(s){return e("div",{key:s.location,staticClass:"gene-item",style:{left:t.getScaledPosition(t.getLeftPosition(s))+"px",width:t.getScaledWidth(t.getWidth(s))+"px",backgroundColor:t.getColor(s.type),zIndex:t.hoveredGene===s.location?10:1},on:{click:function(e){return t.showDetails(s)},mouseenter:function(e){return t.handleGeneHover(s)},mouseleave:function(e){return t.handleGeneLeave(s)}}},[e("span",{staticClass:"gene-type-label"},[t._v(" "+t._s(t.getGeneTypeLabel(s.type))+" ")]),t.hoveredGene===s.location?e("div",{staticClass:"gene-tooltip"},[e("div",[t._v(t._s(s.type))]),e("div",[t._v("位置: "+t._s(s.location))])]):t._e()])})),0)})),0)]),t.showGeneDetailsModal?e("div",{staticClass:"modal"},[e("div",{staticClass:"modal-content"},[e("span",{staticClass:"close",on:{click:t.closeGeneDetailsModal}},[t._v("×")]),e("h3",{staticClass:"modal-title"},[t._v("基因详细信息")]),e("div",{staticClass:"gene-details"},[e("div",{staticClass:"detail-row"},[e("div",{staticClass:"detail-label"},[t._v("基因ID:")]),e("div",{staticClass:"detail-value"},[t._v(t._s(t.currentGeneDetails.location))])]),e("div",{staticClass:"detail-row"},[e("div",{staticClass:"detail-label"},[t._v("基因类型:")]),e("div",{staticClass:"detail-value"},[t._v(t._s(t.currentGeneDetails.type))])]),e("div",{staticClass:"detail-row"},[e("div",{staticClass:"detail-label"},[t._v("位置:")]),e("div",{staticClass:"detail-value"},[t._v(t._s(t.currentGeneDetails.location))])]),e("div",{staticClass:"detail-row"},[e("div",{staticClass:"detail-label"},[t._v("长度:")]),e("div",{staticClass:"detail-value"},[t._v(t._s(t.getWidth(t.currentGeneDetails)))])])])])]):t._e(),t.showTxtReportModal?e("div",{staticClass:"modal"},[e("div",{staticClass:"modal-content"},[e("div",{staticClass:"modal-header"},[e("h3",{staticClass:"modal-title"},[t._v("TXT 分析报告")]),e("button",{staticClass:"modal-download",on:{click:t.downloadTxtReport}},[e("i",{staticClass:"fa-solid fa-download"}),t._v(" 下载 ")]),e("span",{staticClass:"close",on:{click:t.closeTxtReportModal}},[t._v("×")])]),e("div",{staticClass:"report-content",domProps:{innerHTML:t._s(t.formatContent(t.txtReportContent))}})])]):t._e(),t.showGffReportModal?e("div",{staticClass:"modal"},[e("div",{staticClass:"modal-content"},[e("div",{staticClass:"modal-header"},[e("h3",{staticClass:"modal-title"},[t._v("GFF报告")]),e("button",{staticClass:"modal-download",on:{click:t.downloadGffReport}},[e("i",{staticClass:"fa-solid fa-download"}),t._v(" 下载 ")]),e("span",{staticClass:"close",on:{click:t.closeGffReportModal}},[t._v("×")])]),e("div",{staticClass:"gff-modal-content",domProps:{innerHTML:t._s(t.gffReport)}})])]):t._e(),e("div",{staticClass:"ai-report-panel"},[e("div",{staticClass:"ai-report-panel-header"},[t._m(2),e("div",{staticClass:"ai-report-controls"},[t.currentReport?e("button",{staticClass:"ai-report-regenerate",attrs:{disabled:t.isUploading||!t.geneData},on:{click:t.handleStreamSummary}},[e("i",{staticClass:"fa-solid fa-rotate"}),t._v(" 重新生成 ")]):e("button",{staticClass:"ai-report-generate",attrs:{disabled:t.isUploading||!t.geneData},on:{click:t.handleStreamSummary}},[e("i",{staticClass:"fa-solid fa-wand-magic-sparkles"}),t._v(" 生成分析报告 ")]),e("label",{staticClass:"rag-switch"},[e("span",{staticClass:"rag-label"},[t._v("知识库")]),e("div",{staticClass:"switch-container"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.useRAG,expression:"useRAG"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(t.useRAG)?t._i(t.useRAG,null)>-1:t.useRAG},on:{change:function(e){var s=t.useRAG,a=e.target,i=!!a.checked;if(Array.isArray(s)){var o=null,l=t._i(s,o);a.checked?l<0&&(t.useRAG=s.concat([o])):l>-1&&(t.useRAG=s.slice(0,l).concat(s.slice(l+1)))}else t.useRAG=i}}}),e("span",{staticClass:"slider"})])])])]),e("div",{ref:"aiReportPanelBody",staticClass:"ai-report-panel-body"},[t.isUploading&&!t.currentReport?e("div",{staticClass:"ai-report-loading"},[e("i",{staticClass:"fa-solid fa-spinner fa-spin"}),t._v(" 正在生成AI分析报告... ")]):t.uploadError?e("div",{staticClass:"ai-report-error"},[e("i",{staticClass:"fa-solid fa-exclamation-triangle"}),t._v(" "+t._s(t.uploadError)+" ")]):t.currentReport?e("div",{domProps:{innerHTML:t._s(t.formatContent(t.currentReport))}}):e("div",{staticClass:"ai-report-empty"},[t.geneData?e("div",{staticClass:"ai-report-empty-message"},[e("i",{staticClass:"fa-solid fa-lightbulb"}),t._m(3)]):e("div",{staticClass:"ai-report-empty-message"},[e("i",{staticClass:"fa-solid fa-file-import"}),t._m(4)])])])])])]):t._e()])},n=[function(){var t=this,e=t._self._c;return e("h2",{staticClass:"section-title"},[e("i",{staticClass:"fa-solid fa-microscope"}),t._v(" 基因组注释 ")])},function(){var t=this,e=t._self._c;return e("h3",{staticClass:"gene-visualization-title"},[e("i",{staticClass:"fa-solid fa-dna"}),t._v(" 基因组图谱 ")])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"ai-report-title"},[e("i",{staticClass:"fa-solid fa-robot"}),t._v(" AI分析报告 ")])},function(){var t=this,e=t._self._c;return e("div",[e("div",{staticClass:"empty-title"},[t._v("基因组已上传成功")]),e("div",{staticClass:"empty-desc"},[t._v('点击上方"生成分析报告"按钮获取详细的AI分析。')])])},function(){var t=this,e=t._self._c;return e("div",[e("div",{staticClass:"empty-title"},[t._v("还未上传基因组")]),e("div",{staticClass:"empty-desc"},[t._v("请先上传基因组数据后再生成分析报告。")])])}];const r="https://44657667024b.ngrok-free.app";var c={data(){return{reportInfo:{genome_id:"",report_date:""},useRAG:!0,geneData:null,currentReport:null,savedGeneData:null,showLocationTooltip:!1,locationTooltip:"",geneRows:[],showGeneDetailsModal:!1,currentGeneDetails:{},scaleFactor:.035,fileName:"",isUploading:!1,progress:0,progressInterval:null,hoveredGene:null,showRulerTooltip:!1,rulerTooltipPos:0,rulerTooltipText:"",showRulerLine:!0,searchKeyword:"",filteredGeneRows:[],showGffReportModal:!1,gffReport:null,isGeneratingGff:!1,uploadError:null,selectedModelFile:"HyperFusionCortex_v1.pth",modelOptions:[],showTxtReportModal:!1,txtReportContent:""}},computed:{formattedReport(){return this.currentReport?this.formatContent(this.currentReport):""}},watch:{geneData(){this.$nextTick(()=>{this.drawRuler()})},currentReport(){this.$nextTick(()=>{this.scrollToBottom()})}},mounted(){this.geneData&&this.drawRuler(),this.loadModelList()},methods:{async loadModelList(){try{const t=await fetch(r+"/models");if(!t.ok)throw new Error("获取模型列表失败");const e=await t.json();this.modelOptions=e.models.map(t=>({value:t.filename,label:t.display_name+(t.description?` (${t.description})`:"")})),this.modelOptions.length>0&&!this.modelOptions.find(t=>t.value===this.selectedModelFile)&&(this.selectedModelFile=this.modelOptions[0].value)}catch(t){console.error("加载模型列表失败:",t),this.modelOptions=[{value:"HyperFusionCortex_v1.pth",label:"HyperFusionCortex v1"}]}},drawRuler(){const t=this.$refs.rulerCanvas;if(!t||!this.geneData)return;const e=t.getContext("2d"),s=this.geneData.metadata.length,a=this.getScaledWidth(s);t.width=a,t.height=30,t.style.width=a+"px",t.style.height="30px",e.clearRect(0,0,t.width,t.height),e.strokeStyle="#666",e.fillStyle="#666",e.font="10px Arial",e.textAlign="center";for(let i=0;i<=s;i+=1e3){const t=this.getScaledPosition(i);e.beginPath(),e.moveTo(t,0),e.lineTo(t,15),e.stroke(),e.fillText(i/1e3+"k",t,25)}e.strokeStyle="#999";for(let i=0;i<=s;i+=500){if(i%1e3===0)continue;const t=this.getScaledPosition(i);e.beginPath(),e.moveTo(t,5),e.lineTo(t,10),e.stroke()}},handleRulerHover(t){const e=t.currentTarget,s=e.getBoundingClientRect(),a=t.clientX-s.left,i=Math.round(a/this.scaleFactor);this.rulerTooltipPos=a,this.rulerTooltipText=i,this.showRulerTooltip=!0,this.showRulerLine=!0},handleRulerLeave(){this.showRulerTooltip=!1,this.showRulerLine=!1},handleGeneHover(t){this.hoveredGene=t.location},handleGeneLeave(t){this.hoveredGene=null},handleScroll(){const t=this.$refs.geneRowsContainer,e=this.$refs.rulerContainer;t&&e&&(e.scrollLeft=t.scrollLeft)},async handleFileUpload(t){const e=t.target.files[0];if(!e)return;this.fileName=e.name,this.isUploading=!0,this.progress=0,this.uploadError=null,this.$refs.rulerCanvas&&this.drawRuler(),this.progressInterval=setInterval(()=>{this.progress<90&&(this.progress+=2*Math.random())},1e3);const s=new FormData;s.append("file",e),s.append("model_file",this.selectedModelFile);try{const t=await fetch(r+"/upload",{method:"POST",body:s});if(!t.ok)throw new Error("上传失败");const e=await t.json();this.geneData=e.results,this.currentReport=e.summary,this.processGeneRows();let a="";a=e.summary&&e.summary.filename?e.summary.filename:e.summary?Object.keys(e.summary)[0]:e.filename?e.filename:"";const[i,o]=this.parseFilename(a);this.reportInfo={genome_id:i,report_date:o},this.progress=100,setTimeout(async()=>{this.isUploading=!1,clearInterval(this.progressInterval),console.log("基因组处理完成，等待用户手动生成AI分析报告...")},500)}catch(a){console.error("Error:",a),this.uploadError="文件处理失败: "+a.message,this.isUploading=!1,clearInterval(this.progressInterval),alert("文件处理失败: "+a.message)}},parseFilename(t){const e=/(.+)_基因组分析报告_(\d{4}-\d{2}-\d{2})\.txt/,s=t.match(e);return s?[s[1],s[2]]:["",""]},async showReportModal(){if(!this.isUploading&&this.currentReport)if(this.geneData)try{const t=this.geneData.metadata.genome_id,e=(new Date).toISOString().split("T")[0],s=`${r}/summary?genome_id=${t}&current_date=${e}`,a=await fetch(s);if(!a.ok)throw new Error("报告获取失败");const i=await a.json(),o=i[Object.keys(i)[0]];this.txtReportContent=o,this.showTxtReportModal=!0,this.reportInfo={genome_id:t,report_date:e}}catch(t){console.error("TXT报告加载失败:",t),this.txtReportContent="无法加载报告内容："+t.message,this.showTxtReportModal=!0}else alert("没有基因组数据，无法显示报告");else console.log("报告尚未生成或正在生成中，请稍候...")},closeTxtReportModal(){this.showTxtReportModal=!1},downloadTxtReport(){if(!this.txtReportContent)return;const{genome_id:t,report_date:e}=this.reportInfo,s=`${t||"report"}_基因组分析报告_${e||""}.txt`,a=new Blob([this.txtReportContent],{type:"text/plain"}),i=URL.createObjectURL(a),o=document.createElement("a");o.href=i,o.download=s,o.click(),URL.revokeObjectURL(i)},async openGffReportModal(){if(this.isUploading)console.log("正在生成报告，请稍候...");else{this.showGffReportModal=!0,this.isGeneratingGff=!0;try{const t=this.geneData.metadata.genome_id,e=(new Date).toISOString().split("T")[0],s=await fetch(`${r}/generate_gff?genome_id=${t}&current_date=${e}`);if(!s.ok)throw new Error("生成GFF报告失败");const a=await fetch(`${r}/gff?genome_id=${t}&current_date=${e}`);if(!a.ok)throw new Error("获取GFF报告失败");const i=await a.json();this.gffReport=i[Object.keys(i)[0]]}catch(t){console.error("GFF报告处理失败:",t),this.gffReport="无法加载GFF报告内容："+t.message}finally{this.isGeneratingGff=!1}}},closeGffReportModal(){this.showGffReportModal=!1},clearDetection(){this.geneData=null,this.currentReport=null,this.savedGeneData=null,this.$refs.fileInput.value="",this.fileName="",this.uploadError=null,this.gffReport=null},formatContent(t){const e=t.replace(/[*#]/g,""),s=e.split("\n");let a=[],i=[],o=!1;return s.forEach(t=>{t=t.trim();const e=/^\|.+?\|$/.test(t);e?(o||(o=!0),i.push(t)):(o&&(a.push(this.processTable(i)),i=[],o=!1),a.push(this.processTextLine(t)))}),a.join("")},processTextLine(t){return t=t.replace(/[*#]/g,""),/^\d+\.\s/.test(t)?`<h3>${t.replace(/^\d+\.\s/,"")}</h3>`:/^- /.test(t)?`<li>${t.replace(/^- /,"")}</li>`:t?`<p>${t}</p>`:""},processTable(t){if(t.length<2)return"";const e=t[0].split("|").slice(1,-1).map(t=>t.trim()),s=t.slice(2);let a='<table class="summary-table"><thead><tr>';return e.forEach(t=>a+=`<th>${t}</th>`),a+="</tr></thead><tbody>",s.forEach(t=>{const e=t.split("|").slice(1,-1).map(t=>t.trim());a+="<tr>",e.forEach(t=>a+=`<td>${t}</td>`),a+="</tr>"}),a+"</tbody></table>"},getColor(t){const e={NSP1:"#FF6B6B",NSP2:"#4ECDC4",NSP3:"#45B7D1",NSP4:"#FFBE0B",NSP5:"#FB5607",NSP6:"#8338EC",NSP7:"#3A86FF",NSP8:"#FF006E",NSP9:"#88D18A",NSP10:"#118AB2",NSP11:"#8A89C0",NSP12:"#EF476F",NSP13:"#06D6A0",NSP14:"#1B9AAA",NSP15:"#FFC43D",NSP16:"#8A89b0",membrane_protein:"#E2F0F9",envelope_protein:"#FCD5CE",nucleocapsid_protein:"#FFF1CC"};return e[t]||"#CCCCCC"},showDetails(t){this.currentGeneDetails=t,this.showGeneDetailsModal=!0},showLocation(t){this.showLocationTooltip=!0,this.locationTooltip=t},hideLocation(){this.showLocationTooltip=!1},processGeneRows(){this.geneRows=[];const t={};this.geneData.features.forEach(e=>{if(!t[e.location]){t[e.location]=e;let s=!1;for(let t=0;t<this.geneRows.length;t++)if(!this.hasOverlap(this.geneRows[t],e)){this.geneRows[t].push(e),s=!0;break}s||this.geneRows.push([e])}}),this.filterGenes()},filterGenes(){if(!this.searchKeyword)return void(this.filteredGeneRows=JSON.parse(JSON.stringify(this.geneRows)));const t=this.searchKeyword.toLowerCase().trim();this.filteredGeneRows=this.geneRows.map(e=>e.filter(e=>e.type.toLowerCase().includes(t))).filter(t=>t.length>0)},hasOverlap(t,e){const[s,a]=e.location.split("..").map(Number);return t.some(t=>{const[e,i]=t.location.split("..").map(Number);return s<i&&a>e})},getScaledWidth(t){return t*this.scaleFactor},getScaledPosition(t){return t*this.scaleFactor},getLeftPosition(t){return parseInt(t.location.split("..")[0])},getWidth(t){const[e,s]=t.location.split("..").map(Number);return s-e},closeGeneDetailsModal(){this.showGeneDetailsModal=!1},getGeneTypeLabel(t){switch(t){case"membrane_protein":return"M";case"spike_protein":return"S";case"envelope_protein":return"E";case"nucleocapsid_protein":return"N";default:return t}},downloadGffReport(){if(this.gffReport){const{genome_id:t,report_date:e}=this.reportInfo,s=`${t||"gff"}_annotation_${e||""}.gff`,a=new Blob([this.gffReport],{type:"text/plain"}),i=URL.createObjectURL(a),o=document.createElement("a");o.href=i,o.download=s,o.click(),URL.revokeObjectURL(i)}},async streamSummary(t,e){this.isUploading=!0,this.currentReport="",this.uploadError=null;try{const s={genome_id:t,genome_data:e,use_rag:this.useRAG};console.log("生成AI报告，知识库增强: "+(this.useRAG?"开启":"关闭"));const a=await fetch(r+"/stream_summary",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!a.ok)throw new Error(`服务器响应错误: ${a.status} ${a.statusText}`);if(!a.body)throw new Error("流式接口无响应体");const i=a.body.getReader(),o=new TextDecoder("utf-8");let l=!1;this.currentReport="";while(!l){const{value:t,done:e}=await i.read();l=e;let s="";if(t){if(s=o.decode(t,{stream:!l}),s.startsWith("[ERROR]"))throw new Error(s.substring(7));this.currentReport+=s,await this.$nextTick(),this.scrollToBottom()}}}catch(s){this.uploadError="AI分析失败: "+s.message,this.currentReport="生成报告时出错: "+s.message}finally{this.isUploading=!1,await this.$nextTick(),this.scrollToBottom()}},async handleStreamSummary(){if(!this.geneData)return console.error("没有基因数据，无法生成报告"),void(this.uploadError="请先上传基因组数据");this.currentReport="",this.uploadError=null;try{console.log("开始生成AI分析报告...");const t=this.geneData.metadata.genome_id||"unknown";await this.streamSummary(t,this.geneData)}catch(t){console.error("处理流式分析时出错:",t),this.uploadError="AI分析失败: "+t.message,this.currentReport="生成报告失败: "+t.message}},scrollToBottom(){const t=this.$refs.aiReportPanelBody;t&&(console.log("滚动到底部, 高度:",t.scrollHeight),t.scrollTop=t.scrollHeight)}}},d=c,f=(s("22fa"),s("2877")),h=Object(f["a"])(d,l,n,!1,null,"39577f3b",null),p=h.exports,u=function(){var t=this,e=t._self._c;return e("div",{staticClass:"container"},[e("div",{staticClass:"header-section"},[t._m(0),e("button",{staticClass:"refresh-btn",attrs:{disabled:t.loading},on:{click:t.loadReports}},[e("i",{staticClass:"fa-solid fa-sync",class:{"fa-spin":t.loading}}),t._v(" 刷新 ")])]),e("div",{staticClass:"search-section"},[e("div",{staticClass:"search-container"},[e("i",{staticClass:"fa-solid fa-search search-icon"}),e("input",{directives:[{name:"model",rawName:"v-model",value:t.searchId,expression:"searchId"}],staticClass:"search-input",attrs:{placeholder:"按基因组ID搜索报告..."},domProps:{value:t.searchId},on:{input:function(e){e.target.composing||(t.searchId=e.target.value)}}})]),e("div",{staticClass:"report-count"},[t._v(" 共 "+t._s(t.filteredReports.length)+" 个报告 ")])]),t.loading?e("div",{staticClass:"loading-section"},[e("i",{staticClass:"fa-solid fa-spinner fa-spin"}),t._v(" 加载中... ")]):t._e(),t.error?e("div",{staticClass:"error-section"},[e("i",{staticClass:"fa-solid fa-exclamation-triangle"}),t._v(" "+t._s(t.error)+" ")]):t._e(),t.loading||t.error?t._e():e("div",{staticClass:"report-grid"},[t._l(t.filteredReports,(function(s,a){return e("div",{key:a,staticClass:"report-card"},[e("div",{staticClass:"report-card-header"},[t._m(1,!0),e("div",{staticClass:"report-info"},[e("h3",{staticClass:"report-name"},[t._v(t._s(s.genome_id))]),e("p",{staticClass:"report-date"},[t._v(t._s(t.formatDate(s.current_date)))])])]),e("div",{staticClass:"report-card-body"},[e("div",{staticClass:"report-filename"},[e("i",{staticClass:"fa-solid fa-file"}),t._v(" "+t._s(s.filename)+" ")])]),e("div",{staticClass:"report-card-actions"},[e("button",{staticClass:"action-btn view-btn",attrs:{disabled:t.actionLoading[s.filename]},on:{click:function(e){return t.showReport(s)}}},[e("i",{staticClass:"fa-solid fa-eye"}),t._v(" 查看 ")]),e("button",{staticClass:"action-btn details-btn",attrs:{disabled:t.actionLoading[s.filename]},on:{click:function(e){return t.viewReportDetails(s.filename)}}},[e("i",{staticClass:"fa-solid fa-info-circle"}),t._v(" 详情 ")]),e("button",{staticClass:"action-btn download-btn",attrs:{disabled:t.actionLoading[s.filename]},on:{click:function(e){return t.downloadReport(s)}}},[e("i",{staticClass:"fa-solid fa-download"}),t._v(" 下载TXT ")]),e("button",{staticClass:"action-btn gff-btn",attrs:{disabled:t.actionLoading[s.filename]},on:{click:function(e){return t.downloadGFFReport(s)}}},[e("i",{staticClass:"fa-solid fa-file-code"}),t._v(" 下载GFF ")]),e("button",{staticClass:"action-btn delete-btn",attrs:{disabled:t.actionLoading[s.filename]},on:{click:function(e){return t.showDeleteDialog(s)}}},[e("i",{staticClass:"fa-solid fa-trash"}),t._v(" 删除 ")])]),t.actionLoading[s.filename]?e("div",{staticClass:"action-loading"},[e("i",{staticClass:"fa-solid fa-spinner fa-spin"})]):t._e()])})),0===t.filteredReports.length?e("div",{staticClass:"empty-state"},[e("i",{staticClass:"fa-solid fa-folder-open"}),e("h3",[t._v("没有找到报告")]),t.searchId?e("p",[t._v("尝试修改搜索关键词")]):e("p",[t._v("暂无基因组分析报告")])]):t._e()],2),t.selectedReport?e("div",{staticClass:"modal-overlay",on:{click:t.closeReport}},[e("div",{staticClass:"modal-content report-modal",on:{click:function(t){t.stopPropagation()}}},[e("div",{staticClass:"modal-header"},[t._m(2),e("button",{staticClass:"close-btn",on:{click:t.closeReport}},[e("i",{staticClass:"fa-solid fa-times"})])]),e("div",{staticClass:"modal-body"},[t.summary?e("div",{staticClass:"report-content",domProps:{innerHTML:t._s(t.formattedSummary)}}):e("div",{staticClass:"loading-details"},[e("i",{staticClass:"fa-solid fa-spinner fa-spin"}),t._v(" 加载报告中... ")])])])]):t._e(),t.showDetailsModal?e("div",{staticClass:"modal-overlay",on:{click:t.closeDetailsModal}},[e("div",{staticClass:"modal-content details-modal",on:{click:function(t){t.stopPropagation()}}},[e("div",{staticClass:"modal-header"},[t._m(3),e("button",{staticClass:"close-btn",on:{click:t.closeDetailsModal}},[e("i",{staticClass:"fa-solid fa-times"})])]),e("div",{staticClass:"modal-body"},[t.selectedReportDetails?e("div",{staticClass:"details-grid"},[e("div",{staticClass:"detail-item"},[e("label",[t._v("文件名:")]),e("span",[t._v(t._s(t.selectedReportDetails.filename))])]),e("div",{staticClass:"detail-item"},[e("label",[t._v("基因组ID:")]),e("span",[t._v(t._s(t.selectedReportDetails.genome_id))])]),e("div",{staticClass:"detail-item"},[e("label",[t._v("分析日期:")]),e("span",[t._v(t._s(t.selectedReportDetails.analysis_date))])]),e("div",{staticClass:"detail-item"},[e("label",[t._v("文件大小:")]),e("span",[t._v(t._s(t.selectedReportDetails.file_size))])]),e("div",{staticClass:"detail-item"},[e("label",[t._v("最后修改:")]),e("span",[t._v(t._s(t.formatTimestamp(t.selectedReportDetails.last_modified)))])])]):e("div",{staticClass:"loading-details"},[e("i",{staticClass:"fa-solid fa-spinner fa-spin"}),t._v(" 加载详情中... ")])])])]):t._e(),t.showDeleteModal?e("div",{staticClass:"modal-overlay",on:{click:t.closeDeleteModal}},[e("div",{staticClass:"modal-content delete-modal",on:{click:function(t){t.stopPropagation()}}},[e("div",{staticClass:"modal-header"},[t._m(4),e("button",{staticClass:"close-btn",on:{click:t.closeDeleteModal}},[e("i",{staticClass:"fa-solid fa-times"})])]),e("div",{staticClass:"modal-body"},[e("p",[t._v("确定要删除报告 "),e("strong",[t._v(t._s(t.selectedReportForDelete&&t.selectedReportForDelete.filename))]),t._v(" 吗？")]),e("p",{staticClass:"warning-text"},[t._v("此操作将同时删除相关的JSON和GFF文件，且不可撤销。")])]),e("div",{staticClass:"modal-footer"},[e("button",{staticClass:"btn btn-secondary",on:{click:t.closeDeleteModal}},[t._v("取消")]),e("button",{staticClass:"btn btn-danger",attrs:{disabled:t.deleting},on:{click:t.confirmDelete}},[t.deleting?e("i",{staticClass:"fa-solid fa-spinner fa-spin"}):t._e(),t._v(" "+t._s(t.deleting?"删除中...":"确认删除")+" ")])])])]):t._e(),t.notification.show?e("div",{class:["notification",t.notification.type]},[e("i",{class:t.notificationIcon}),t._v(" "+t._s(t.notification.message)+" ")]):t._e()])},m=[function(){var t=this,e=t._self._c;return e("h2",{staticClass:"section-title"},[e("i",{staticClass:"fa-solid fa-database"}),t._v(" 基因组分析报告 ")])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"report-icon"},[e("i",{staticClass:"fa-solid fa-chart-line"})])},function(){var t=this,e=t._self._c;return e("h3",[e("i",{staticClass:"fa-solid fa-file-chart-line"}),t._v(" 分析报告")])},function(){var t=this,e=t._self._c;return e("h3",[e("i",{staticClass:"fa-solid fa-info-circle"}),t._v(" 报告详情")])},function(){var t=this,e=t._self._c;return e("h3",[e("i",{staticClass:"fa-solid fa-exclamation-triangle text-danger"}),t._v(" 删除报告")])}],v={data(){return{reports:[],selectedReport:null,summary:null,searchId:"",loading:!1,error:null,actionLoading:{},showDetailsModal:!1,showDeleteModal:!1,selectedReportDetails:null,selectedReportForDelete:null,deleting:!1,notification:{show:!1,message:"",type:"success"}}},computed:{formattedSummary(){if(!this.summary)return"";const t=this.summary.replace(/[*#]/g,""),e=t.split("\n"),s=e.reduce((t,e)=>{e=e.trim();const s=/^\|.*\|$/.test(e);if(s)t.tableRows.push(e),t.inTable=!0;else{if(t.inTable){const e=this.processTable(t.tableRows);t.htmlArray.push(e),t.tableRows=[],t.inTable=!1}let s=this.processTextLine(e);s&&t.htmlArray.push(s)}return t},{inTable:!1,tableRows:[],htmlArray:[]});if(s.inTable){const t=this.processTable(s.tableRows);s.htmlArray.push(t)}let a=s.htmlArray.join("").replace(/<li>/g,"<ul><li>").replace(/<\/li>/g,"</li></ul>").replace(/<\/ul><ul>/g,"");return a},filteredReports(){if(!this.searchId.trim())return this.reports;const t=this.searchId.toLowerCase().trim();return this.reports.filter(e=>e.genome_id.toLowerCase().includes(t)||e.filename.toLowerCase().includes(t))},notificationIcon(){const t={success:"fa-solid fa-check-circle",error:"fa-solid fa-exclamation-circle",warning:"fa-solid fa-exclamation-triangle"};return t[this.notification.type]||t.success}},mounted(){this.loadReports()},methods:{async loadReports(){this.loading=!0,this.error=null;try{const t=await fetch(r+"/getAllSummaries");if(!t.ok)throw new Error(`HTTP ${t.status}: ${t.statusText}`);const e=await t.json();this.reports=e.map(t=>{const e=t.split("_基因组分析报告_");if(2===e.length){const s=e[0],a=e[1].replace(".txt","");return{filename:t,genome_id:s,current_date:a}}return null}).filter(t=>null!==t),this.actionLoading={}}catch(t){console.error("加载报告列表失败:",t),this.error=t.message||"加载报告列表失败",this.reports=[]}finally{this.loading=!1}},async showReport(t){if(t&&t.filename){this.setActionLoading(t.filename,!0);try{const{genome_id:e,current_date:s}=t,a=await fetch(`${r}/summary?genome_id=${e}&current_date=${s}`);if(!a.ok)throw new Error("获取报告内容失败: "+a.statusText);const i=await a.json();this.summary=Object.values(i)[0],this.selectedReport=t.filename}catch(e){console.error("获取报告内容失败:",e),this.showNotification("获取报告内容失败: "+e.message,"error")}finally{this.setActionLoading(t.filename,!1)}}else this.showNotification("报告信息不完整或文件名未定义","error")},async viewReportDetails(t){this.setActionLoading(t,!0);try{const e=await fetch(`${r}/reports/${t}/details`);if(!e.ok)throw new Error("获取报告详情失败: "+e.statusText);this.selectedReportDetails=await e.json(),this.showDetailsModal=!0}catch(e){console.error("获取报告详情失败:",e),this.showNotification("获取报告详情失败: "+e.message,"error")}finally{this.setActionLoading(t,!1)}},async downloadReport(t){this.setActionLoading(t.filename,!0);try{const{genome_id:e,current_date:s}=t,a=await fetch(`${r}/summary?genome_id=${e}&current_date=${s}`);if(!a.ok)throw new Error("获取报告内容失败: "+a.statusText);const i=await a.json(),o=Object.values(i)[0],l=document.createElement("a");l.href=URL.createObjectURL(new Blob([o.replace(/[*#]/g,"")],{type:"text/plain"})),l.download=t.filename,l.click(),this.showNotification("报告下载成功","success")}catch(e){console.error("下载报告失败:",e),this.showNotification("下载报告失败: "+e.message,"error")}finally{this.setActionLoading(t.filename,!1)}},async downloadGFFReport(t){this.setActionLoading(t.filename,!0);try{const{genome_id:e,current_date:s}=t,a=`${e}_annotation_${s}.gff`,i=await fetch(`${r}/gff?genome_id=${e}&current_date=${s}`);if(!i.ok)throw new Error("获取GFF报告失败: "+i.statusText);const o=await i.json(),l=o[a],n=l.replace(/(\S+)\s+(\S+)\s+(\S+)\s+(\S+)\s+(\S+)\s+(\S+)\s+(\S+)\s+(\S+)\s+(.+)/g,"$1\t$2\t$3\t$4\t$5\t$6\t$7\t$8\t$9"),c=new Blob([n],{type:"text/plain"}),d=window.URL.createObjectURL(c),f=document.createElement("a");f.href=d,f.download=a,f.click(),window.URL.revokeObjectURL(d),this.showNotification("GFF报告下载成功","success")}catch(e){console.error("下载GFF报告失败:",e),this.showNotification("下载GFF报告失败: "+e.message,"error")}finally{this.setActionLoading(t.filename,!1)}},showDeleteDialog(t){this.selectedReportForDelete=t,this.showDeleteModal=!0},async confirmDelete(){if(!this.deleting){this.deleting=!0;try{const t=await fetch(`${r}/reports/${this.selectedReportForDelete.filename}`,{method:"DELETE"});if(!t.ok){const e=await t.json();throw new Error(e.error||"删除失败")}this.showNotification("报告删除成功","success"),this.closeDeleteModal(),this.loadReports()}catch(t){console.error("删除报告失败:",t),this.showNotification("删除失败: "+t.message,"error")}finally{this.deleting=!1}}},processTextLine(t){return t=t.replace(/[*#]/g,""),/^\d+\.\s/.test(t)?`<h3>${t.replace(/^\d+\.\s/,"")}</h3>`:/^- /.test(t)?`<li>${t.replace(/^- /,"")}</li>`:t?`<p>${t}</p>`:""},processTable(t){if(t.length<2)return"";const e=t[0].split("|").slice(1,-1).map(t=>t.trim().replace(/[*#]/g,"")),s=t.slice(2).map(t=>t.split("|").slice(1,-1).map(t=>t.trim().replace(/[*#]/g,"")));let a='<table class="summary-table"><thead><tr>';return e.forEach(t=>{a+=`<th>${t}</th>`}),a+="</tr></thead><tbody>",s.forEach(t=>{a+="<tr>",t.forEach(t=>{a+=`<td>${t}</td>`}),a+="</tr>"}),a+"</tbody></table>"},downloadSummary(){if(this.summary){const t=document.createElement("a");t.href=URL.createObjectURL(new Blob([this.summary.replace(/[*#]/g,"")],{type:"text/plain"})),t.download=this.selectedReport,t.click(),this.showNotification("报告下载成功","success")}},setActionLoading(t,e){this.$set(this.actionLoading,t,e)},closeReport(){this.selectedReport=null,this.summary=null},closeDetailsModal(){this.showDetailsModal=!1,this.selectedReportDetails=null},closeDeleteModal(){this.showDeleteModal=!1,this.selectedReportForDelete=null,this.deleting=!1},showNotification(t,e="success"){this.notification={show:!0,message:t,type:e},setTimeout(()=>{this.notification.show=!1},3e3)},formatDate(t){if(!t)return"未知";const e=new Date(t);return isNaN(e.getTime())?t:e.toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric"})},formatTimestamp(t){if(!t)return"未知";const e=new Date(1e3*t);return e.toLocaleString("zh-CN")}}},g=v,_=(s("ea8d"),Object(f["a"])(g,u,m,!1,null,"fd425448",null)),C=_.exports,w=function(){var t=this,e=t._self._c;return e("div",{staticClass:"container gradient-bg"},[t._m(0),e("div",{staticClass:"form-row-flex card"},[e("div",{staticClass:"form-col"},[e("label",{staticClass:"form-label"},[t._v("选择已有模型（可选）：")]),e("select",{directives:[{name:"model",rawName:"v-model",value:t.selectedModel,expression:"selectedModel"}],staticClass:"form-select",on:{change:function(e){var s=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.selectedModel=e.target.multiple?s:s[0]}}},[e("option",{attrs:{value:""}},[t._v("不使用预训练")]),t._l(t.modelList,(function(s){return e("option",{key:s,domProps:{value:s}},[t._v(t._s(s))])}))],2)]),e("div",{staticClass:"form-divider"}),e("div",{staticClass:"form-col"},[e("label",{staticClass:"form-label"},[t._v("上传数据集：")]),e("div",{staticClass:"file-upload-container"},[t._m(1),e("input",{staticClass:"form-file",attrs:{id:"file-upload",type:"file",accept:".fasta,.fa",webkitdirectory:"",multiple:""},on:{change:t.handleFileChange}}),t.fileName?e("span",{staticClass:"file-name"},[t._v(t._s(t.fileName))]):t._e()])])]),e("div",{staticClass:"form-row card",staticStyle:{"flex-wrap":"wrap",gap:"1.5rem"}},[e("div",[e("label",[t._v("max_length：")]),e("input",{directives:[{name:"model",rawName:"v-model.number",value:t.form.max_length,expression:"form.max_length",modifiers:{number:!0}}],staticClass:"input-beauty",staticStyle:{width:"90px"},attrs:{type:"number",min:"100",max:"100000",step:"100"},domProps:{value:t.form.max_length},on:{input:function(e){e.target.composing||t.$set(t.form,"max_length",t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}})]),e("div",[e("label",[t._v("batch_size：")]),e("input",{directives:[{name:"model",rawName:"v-model.number",value:t.form.batch_size,expression:"form.batch_size",modifiers:{number:!0}}],staticClass:"input-beauty",staticStyle:{width:"70px"},attrs:{type:"number",min:"1",max:"1024",step:"1"},domProps:{value:t.form.batch_size},on:{input:function(e){e.target.composing||t.$set(t.form,"batch_size",t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}})]),e("div",[e("label",[t._v("epochs：")]),e("input",{directives:[{name:"model",rawName:"v-model.number",value:t.form.epochs,expression:"form.epochs",modifiers:{number:!0}}],staticClass:"input-beauty",staticStyle:{width:"60px"},attrs:{type:"number",min:"1",max:"1000",step:"1"},domProps:{value:t.form.epochs},on:{input:function(e){e.target.composing||t.$set(t.form,"epochs",t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}})]),e("div",[e("label",[t._v("learning_rate：")]),e("input",{directives:[{name:"model",rawName:"v-model.number",value:t.form.learning_rate,expression:"form.learning_rate",modifiers:{number:!0}}],staticClass:"input-beauty",staticStyle:{width:"90px"},attrs:{type:"number",min:"0.00001",max:"1",step:"0.00001"},domProps:{value:t.form.learning_rate},on:{input:function(e){e.target.composing||t.$set(t.form,"learning_rate",t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}})]),e("div",[e("label",[t._v("val_ratio：")]),e("input",{directives:[{name:"model",rawName:"v-model.number",value:t.form.val_ratio,expression:"form.val_ratio",modifiers:{number:!0}}],staticClass:"input-beauty",staticStyle:{width:"60px"},attrs:{type:"number",min:"0.01",max:"0.99",step:"0.01"},domProps:{value:t.form.val_ratio},on:{input:function(e){e.target.composing||t.$set(t.form,"val_ratio",t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}})])]),e("div",{staticClass:"model-name-row card"},[e("label",{staticClass:"form-label"},[t._v("新模型名：")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.form.new_model_name,expression:"form.new_model_name"}],staticClass:"input-beauty model-name-input",attrs:{placeholder:"仅字母数字下划线",maxlength:"32"},domProps:{value:t.form.new_model_name},on:{input:function(e){e.target.composing||t.$set(t.form,"new_model_name",e.target.value)}}})]),e("div",{staticClass:"form-row card"},[e("button",{staticClass:"train-button gradient-btn",attrs:{disabled:!t.fileName||!t.form.new_model_name||t.isTraining},on:{click:t.startTraining}},[e("i",{staticClass:"fa-solid fa-play"}),t._v(" 开始训练 ")])]),t.isTraining?e("div",{staticClass:"progress-container card progress-card-narrow"},[e("div",{staticClass:"progress-label"},[t._v("训练进度："),e("span",{staticClass:"progress-percent"},[t._v(t._s(t.progress)+"%")])]),e("div",{staticClass:"progress-bar-container"},[e("div",{staticClass:"progress-bar gradient-progress",style:{width:t.progress+"%"}})])]):t._e(),t.epochLogs.length?e("div",{staticClass:"card log-card-narrow"},[e("h3",{staticStyle:{"margin-bottom":"1rem"}},[t._v("训练过程")]),t.epochLogs.length?e("table",{staticClass:"train-log-table"},[t._m(2),e("tbody",t._l(t.epochLogs,(function(s){return e("tr",{key:s.epoch},[e("td",[t._v(t._s(s.epoch))]),e("td",[t._v(t._s(s.train.loss.toFixed(4)))]),e("td",[t._v(t._s((100*s.train.accuracy).toFixed(2))+"%")]),e("td",[t._v(t._s(s.val.loss.toFixed(4)))]),e("td",[t._v(t._s((100*s.val.accuracy).toFixed(2))+"%")]),e("td",[t._v(t._s(s.learning_rate.toExponential(2)))])])})),0)]):t._e()]):t._e(),t.trainingFinished?e("div",{staticClass:"result-section card result-section-beauty"},[e("div",{staticClass:"saved-tip saved-tip-beauty"},[e("i",{staticClass:"fa-solid fa-check-circle"}),e("span",[t._v("模型已自动保存为 "),e("b",[t._v(t._s(t.form.new_model_name)+".pth")]),t._v(" / "),e("b",[t._v(t._s(t.form.new_model_name)+".json")])]),e("button",{staticClass:"cancel-btn",on:{click:t.resetAll}},[t._v("关闭")])])]):t._e(),t.errorMsg?e("div",{staticClass:"error-tip card"},[e("i",{staticClass:"fa-solid fa-exclamation-triangle"}),t._v(" "+t._s(t.errorMsg))]):t._e()])},b=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"header-section card"},[e("h2",{staticClass:"section-title"},[e("i",{staticClass:"fa-solid fa-brain"}),t._v(" 预训练模型训练 ")])])},function(){var t=this,e=t._self._c;return e("label",{staticClass:"file-upload-btn",attrs:{for:"file-upload"}},[e("i",{staticClass:"fa-solid fa-cloud-upload-alt"}),t._v(" 选择文件 ")])},function(){var t=this,e=t._self._c;return e("thead",[e("tr",[e("th",[t._v("Epoch")]),e("th",[t._v("Train Loss")]),e("th",[t._v("Train Acc")]),e("th",[t._v("Val Loss")]),e("th",[t._v("Val Acc")]),e("th",[t._v("LR")])])])}],y={data(){return{modelList:["HybridModel_v1","HyperFusionCortex_v1","MSA_ResGRUNet_protein_classifier","MSA_ResGRUNet_v1","protein_classifier"],selectedModel:"",fileName:"",isTraining:!1,progress:0,trainingFinished:!1,metrics:{accuracy:"--",loss:"--"},fileList:[],errorMsg:"",modelBin:null,modelJson:null,epochLogs:[],form:{max_length:1e4,batch_size:32,epochs:10,learning_rate:1e-4,val_ratio:.2,new_model_name:""}}},methods:{handleFileChange(t){const e=Array.from(t.target.files);this.fileList=e,this.fileName=e.length>0?`已选择${e.length}个文件`:""},async startTraining(){this.isTraining=!0,this.progress=0,this.trainingFinished=!1,this.errorMsg="",this.metrics={accuracy:"--",loss:"--"},this.epochLogs=[];const t=new FormData;this.fileList&&this.fileList.length>0&&this.fileList.forEach(e=>t.append("file",e)),this.selectedModel&&t.append("pretrain_model",this.selectedModel),t.append("model_type",this.selectedModel?this.selectedModel.replace(".pth","").replace("_v1","").replace("_protein_classifier",""):"HybridModel"),t.append("max_length",this.form.max_length),t.append("batch_size",this.form.batch_size),t.append("epochs",this.form.epochs),t.append("learning_rate",this.form.learning_rate),t.append("val_ratio",this.form.val_ratio),t.append("new_model_name",this.form.new_model_name);try{const e=r+"/train_model",s=await fetch(e,{method:"POST",body:t});if(!s.body)throw new Error("No response body");const a=s.body.getReader();let i="",o=!1,l=this.form.epochs;while(!o){const{value:t,done:e}=await a.read();if(o=e,t){i+=(new TextDecoder).decode(t);let e=i.split("\n");i=e.pop();for(let t of e){if(!t.trim())continue;let e;try{e=JSON.parse(t)}catch{continue}if("epoch"===e.type)this.epochLogs.push(e),this.progress=Math.round(e.epoch/l*100);else if("done"===e.type)this.modelBin=e.model_bytes,this.modelJson=e.model_json,this.trainingFinished=!0,e.model_json&&e.model_json.metrics&&(this.metrics={accuracy:e.model_json.metrics.accuracy||"--",loss:e.model_json.metrics.loss||"--"}),this.progress=100,this.isTraining=!1;else if(e.error)return this.errorMsg=e.error,void(this.isTraining=!1)}}}}catch(e){this.errorMsg="训练失败："+e.message,this.isTraining=!1}this.isTraining=!1},downloadModel(){if(!this.modelBin||!this.modelJson)return;const t=new Uint8Array(this.modelBin.match(/.{1,2}/g).map(t=>parseInt(t,16))),e=new Blob([t],{type:"application/octet-stream"}),s=document.createElement("a");s.href=URL.createObjectURL(e),s.download=(this.form.new_model_name||"trained_model")+".pth",s.click();const a=new Blob([JSON.stringify(this.modelJson,null,2)],{type:"application/json"}),i=document.createElement("a");i.href=URL.createObjectURL(a),i.download=(this.form.new_model_name||"trained_model")+".json",i.click()},resetAll(){this.selectedModel="",this.fileName="",this.isTraining=!1,this.progress=0,this.trainingFinished=!1,this.form={max_length:1e4,batch_size:32,epochs:10,learning_rate:1e-4,val_ratio:.2,new_model_name:""},this.errorMsg="",this.modelBin=null,this.modelJson=null,this.epochLogs=[],this.fileList=[]}}},R=y,M=(s("74f8"),Object(f["a"])(R,w,b,!1,null,"c132f6c0",null)),x=M.exports,D=function(){var t=this,e=t._self._c;return e("div",{staticClass:"container"},[e("div",{staticClass:"header-section"},[t._m(0),e("div",{staticClass:"header-actions"},[e("button",{staticClass:"model-btn promoter-btn",attrs:{disabled:t.pulling.promoter},on:{click:t.pullPromoterModel}},[e("i",{staticClass:"fa-solid fa-cloud-download-alt"}),t.pulling.promoter?e("span",[t._v("拉取中...")]):e("span",[t._v("拉取启动子识别模型")])]),e("button",{staticClass:"model-btn embedding-btn",attrs:{disabled:t.pulling.embedding},on:{click:t.pullEmbeddingModel}},[e("i",{staticClass:"fa-solid fa-cloud-download-alt"}),t.pulling.embedding?e("span",[t._v("拉取中...")]):e("span",[t._v("拉取文本向量化模型")])]),e("button",{staticClass:"refresh-btn",attrs:{disabled:t.loading},on:{click:t.loadModels}},[e("i",{staticClass:"fa-solid fa-sync",class:{"fa-spin":t.loading}}),t._v(" 刷新 ")])])]),e("div",{staticClass:"search-section"},[e("div",{staticClass:"search-container"},[e("i",{staticClass:"fa-solid fa-search search-icon"}),e("input",{directives:[{name:"model",rawName:"v-model",value:t.searchKeyword,expression:"searchKeyword"}],staticClass:"search-input",attrs:{placeholder:"搜索模型..."},domProps:{value:t.searchKeyword},on:{input:function(e){e.target.composing||(t.searchKeyword=e.target.value)}}})]),e("div",{staticClass:"model-count"},[t._v(" 共 "+t._s(t.filteredModels.length)+" 个模型 ")])]),t.loading?e("div",{staticClass:"loading-section"},[e("i",{staticClass:"fa-solid fa-spinner fa-spin"}),t._v(" 加载中... ")]):t._e(),t.error?e("div",{staticClass:"error-section"},[e("i",{staticClass:"fa-solid fa-exclamation-triangle"}),t._v(" "+t._s(t.error)+" ")]):t._e(),t.loading||t.error?t._e():e("div",{staticClass:"model-grid"},[t._l(t.filteredModels,(function(s){return e("div",{key:s.filename,staticClass:"model-card"},[e("div",{staticClass:"model-card-header"},[t._m(1,!0),e("div",{staticClass:"model-info"},[e("h3",{staticClass:"model-name"},[t._v(t._s(s.display_name))]),e("p",{staticClass:"model-type"},[t._v(t._s(s.model_type||"未知类型"))])])]),e("div",{staticClass:"model-card-body"},[e("div",{staticClass:"model-filename"},[e("i",{staticClass:"fa-solid fa-file"}),t._v(" "+t._s(s.filename)+" ")])]),e("div",{staticClass:"model-card-actions"},[e("button",{staticClass:"action-btn view-btn",attrs:{disabled:t.actionLoading[s.filename]},on:{click:function(e){return t.viewModelDetails(s.filename)}}},[e("i",{staticClass:"fa-solid fa-eye"}),t._v(" 详情 ")]),e("button",{staticClass:"action-btn rename-btn",attrs:{disabled:t.actionLoading[s.filename]},on:{click:function(e){return t.showRenameDialog(s)}}},[e("i",{staticClass:"fa-solid fa-edit"}),t._v(" 重命名 ")]),e("button",{staticClass:"action-btn export-btn",attrs:{disabled:t.actionLoading[s.filename]},on:{click:function(e){return t.exportModel(s.filename)}}},[e("i",{staticClass:"fa-solid fa-download"}),t._v(" 导出 ")]),e("button",{staticClass:"action-btn delete-btn",attrs:{disabled:t.actionLoading[s.filename]},on:{click:function(e){return t.showDeleteDialog(s)}}},[e("i",{staticClass:"fa-solid fa-trash"}),t._v(" 删除 ")])]),t.actionLoading[s.filename]?e("div",{staticClass:"action-loading"},[e("i",{staticClass:"fa-solid fa-spinner fa-spin"})]):t._e()])})),0===t.filteredModels.length?e("div",{staticClass:"empty-state"},[e("i",{staticClass:"fa-solid fa-folder-open"}),e("h3",[t._v("没有找到模型")]),t.searchKeyword?e("p",[t._v("尝试修改搜索关键词")]):e("p",[t._v("model文件夹中没有可用的模型文件")])]):t._e()],2),t.showDetailsModal?e("div",{staticClass:"modal-overlay",on:{click:t.closeDetailsModal}},[e("div",{staticClass:"modal-content details-modal",on:{click:function(t){t.stopPropagation()}}},[e("div",{staticClass:"modal-header"},[t._m(2),e("button",{staticClass:"close-btn",on:{click:t.closeDetailsModal}},[e("i",{staticClass:"fa-solid fa-times"})])]),e("div",{staticClass:"modal-body"},[t.selectedModelDetails?e("div",{staticClass:"details-grid"},[e("div",{staticClass:"detail-item"},[e("label",[t._v("文件名:")]),e("span",[t._v(t._s(t.selectedModelDetails.filename))])]),e("div",{staticClass:"detail-item"},[e("label",[t._v("文件大小:")]),e("span",[t._v(t._s(t.selectedModelDetails.file_size))])]),e("div",{staticClass:"detail-item"},[e("label",[t._v("模型类型:")]),e("span",[t._v(t._s(t.selectedModelDetails.model_type))])]),e("div",{staticClass:"detail-item"},[e("label",[t._v("最后修改:")]),e("span",[t._v(t._s(t.formatDate(t.selectedModelDetails.last_modified)))])]),e("div",{staticClass:"detail-item"},[e("label",[t._v("配置文件:")]),e("span",{class:t.selectedModelDetails.config_available?"status-yes":"status-no"},[t._v(" "+t._s(t.selectedModelDetails.config_available?"存在":"缺少")+" ")])]),t.selectedModelDetails.config_available&&t.selectedModelDetails.config_data?e("div",{staticClass:"config-section"},[e("h4",[t._v("配置详情")]),e("div",{staticClass:"config-data"},[e("pre",[t._v(t._s(JSON.stringify(t.selectedModelDetails.config_data,null,2)))])])]):t._e()]):e("div",{staticClass:"loading-details"},[e("i",{staticClass:"fa-solid fa-spinner fa-spin"}),t._v(" 加载详情中... ")])])])]):t._e(),t.showRenameModal?e("div",{staticClass:"modal-overlay",on:{click:t.closeRenameModal}},[e("div",{staticClass:"modal-content rename-modal",on:{click:function(t){t.stopPropagation()}}},[e("div",{staticClass:"modal-header"},[t._m(3),e("button",{staticClass:"close-btn",on:{click:t.closeRenameModal}},[e("i",{staticClass:"fa-solid fa-times"})])]),e("div",{staticClass:"modal-body"},[e("div",{staticClass:"form-group"},[e("label",[t._v("当前名称:")]),e("span",{staticClass:"current-name"},[t._v(t._s(t.selectedModel&&t.selectedModel.filename))])]),e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"newName"}},[t._v("新名称:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.newModelName,expression:"newModelName"}],staticClass:"rename-input",attrs:{id:"newName",placeholder:"输入新的模型名称"},domProps:{value:t.newModelName},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.confirmRename.apply(null,arguments)},input:function(e){e.target.composing||(t.newModelName=e.target.value)}}}),e("small",{staticClass:"input-hint"},[t._v("名称将自动添加.pth后缀")])])]),e("div",{staticClass:"modal-footer"},[e("button",{staticClass:"btn btn-secondary",on:{click:t.closeRenameModal}},[t._v("取消")]),e("button",{staticClass:"btn btn-primary",attrs:{disabled:!t.newModelName.trim()||t.renaming},on:{click:t.confirmRename}},[t.renaming?e("i",{staticClass:"fa-solid fa-spinner fa-spin"}):t._e(),t._v(" "+t._s(t.renaming?"重命名中...":"确认")+" ")])])])]):t._e(),t.showDeleteModal?e("div",{staticClass:"modal-overlay",on:{click:t.closeDeleteModal}},[e("div",{staticClass:"modal-content delete-modal",on:{click:function(t){t.stopPropagation()}}},[e("div",{staticClass:"modal-header"},[t._m(4),e("button",{staticClass:"close-btn",on:{click:t.closeDeleteModal}},[e("i",{staticClass:"fa-solid fa-times"})])]),e("div",{staticClass:"modal-body"},[e("p",[t._v("确定要删除模型 "),e("strong",[t._v(t._s(t.selectedModel&&t.selectedModel.filename))]),t._v(" 吗？")]),e("p",{staticClass:"warning-text"},[t._v("此操作不可撤销，模型文件和配置文件都会被删除。")])]),e("div",{staticClass:"modal-footer"},[e("button",{staticClass:"btn btn-secondary",on:{click:t.closeDeleteModal}},[t._v("取消")]),e("button",{staticClass:"btn btn-danger",attrs:{disabled:t.deleting},on:{click:t.confirmDelete}},[t.deleting?e("i",{staticClass:"fa-solid fa-spinner fa-spin"}):t._e(),t._v(" "+t._s(t.deleting?"删除中...":"确认删除")+" ")])])])]):t._e(),t.notification.show?e("div",{class:["notification",t.notification.type]},[e("i",{class:t.notificationIcon}),t._v(" "+t._s(t.notification.message)+" ")]):t._e()])},T=[function(){var t=this,e=t._self._c;return e("h2",{staticClass:"section-title"},[e("i",{staticClass:"fa-solid fa-database"}),t._v(" 模型管理 ")])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"model-icon"},[e("i",{staticClass:"fa-solid fa-brain"})])},function(){var t=this,e=t._self._c;return e("h3",[e("i",{staticClass:"fa-solid fa-info-circle"}),t._v(" 模型详情")])},function(){var t=this,e=t._self._c;return e("h3",[e("i",{staticClass:"fa-solid fa-edit"}),t._v(" 重命名模型")])},function(){var t=this,e=t._self._c;return e("h3",[e("i",{staticClass:"fa-solid fa-exclamation-triangle text-danger"}),t._v(" 删除模型")])}],k={data(){return{searchKeyword:"",models:[],loading:!1,error:null,actionLoading:{},pulling:{promoter:!1,embedding:!1},showDetailsModal:!1,showRenameModal:!1,showDeleteModal:!1,selectedModel:null,selectedModelDetails:null,newModelName:"",renaming:!1,deleting:!1,notification:{show:!1,message:"",type:"success"}}},computed:{filteredModels(){if(!this.searchKeyword.trim())return this.models;const t=this.searchKeyword.toLowerCase().trim();return this.models.filter(e=>e.filename.toLowerCase().includes(t)||e.display_name.toLowerCase().includes(t)||e.model_type&&e.model_type.toLowerCase().includes(t))},notificationIcon(){const t={success:"fa-solid fa-check-circle",error:"fa-solid fa-exclamation-circle",warning:"fa-solid fa-exclamation-triangle"};return t[this.notification.type]||t.success}},mounted(){this.loadModels()},methods:{async loadModels(){this.loading=!0,this.error=null;try{const t=await fetch(r+"/models");if(!t.ok)throw new Error(`HTTP ${t.status}: ${t.statusText}`);const e=await t.json();this.models=e.models||[],this.actionLoading={}}catch(t){console.error("加载模型列表失败:",t),this.error=t.message||"加载模型列表失败",this.models=[]}finally{this.loading=!1}},async viewModelDetails(t){this.setActionLoading(t,!0);try{const e=await fetch(`${r}/models/${t}/details`);if(!e.ok)throw new Error("获取模型详情失败: "+e.statusText);this.selectedModelDetails=await e.json(),this.showDetailsModal=!0}catch(e){console.error("获取模型详情失败:",e),this.showNotification("获取模型详情失败: "+e.message,"error")}finally{this.setActionLoading(t,!1)}},showRenameDialog(t){this.selectedModel=t,this.newModelName=t.filename.replace(".pth",""),this.showRenameModal=!0},async confirmRename(){if(this.newModelName.trim()&&!this.renaming){this.renaming=!0;try{const t=await fetch(`${r}/models/${this.selectedModel.filename}/rename`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({new_name:this.newModelName.trim()})});if(!t.ok){const e=await t.json();throw new Error(e.error||"重命名失败")}this.showNotification("模型重命名成功","success"),this.closeRenameModal(),this.loadModels()}catch(t){console.error("重命名模型失败:",t),this.showNotification("重命名失败: "+t.message,"error")}finally{this.renaming=!1}}},showDeleteDialog(t){this.selectedModel=t,this.showDeleteModal=!0},async confirmDelete(){if(!this.deleting){this.deleting=!0;try{const t=await fetch(`${r}/models/${this.selectedModel.filename}`,{method:"DELETE"});if(!t.ok){const e=await t.json();throw new Error(e.error||"删除失败")}this.showNotification("模型删除成功","success"),this.closeDeleteModal(),this.loadModels()}catch(t){console.error("删除模型失败:",t),this.showNotification("删除失败: "+t.message,"error")}finally{this.deleting=!1}}},async exportModel(t){this.setActionLoading(t,!0);try{const e=await fetch(`${r}/models/${t}/export`);if(!e.ok)throw new Error("导出失败: "+e.statusText);const s=e.headers.get("content-disposition");let a=t;if(s&&-1!==s.indexOf("filename=")){const e=s.split("filename=")[1];a=e?e.replace(/"/g,""):t}const i=await e.blob(),o=window.URL.createObjectURL(i),l=document.createElement("a");l.href=o,l.download=a,document.body.appendChild(l),l.click(),document.body.removeChild(l),window.URL.revokeObjectURL(o),this.showNotification("模型导出成功","success")}catch(e){console.error("导出模型失败:",e),this.showNotification("导出失败: "+e.message,"error")}finally{this.setActionLoading(t,!1)}},setActionLoading(t,e){this.$set(this.actionLoading,t,e)},async pullPromoterModel(){if(!this.pulling.promoter){this.pulling.promoter=!0;try{const t=await fetch(r+"/models/pull/promoter",{method:"POST"}),e=await t.json();if(!t.ok)throw new Error(e.error||"拉取启动子识别模型失败");e.warning?this.showNotification(e.message,"warning"):this.showNotification(e.message||"启动子识别模型拉取成功","success"),this.loadModels()}catch(t){console.error("拉取启动子识别模型失败:",t),this.showNotification("拉取失败: "+t.message,"error")}finally{this.pulling.promoter=!1}}},async pullEmbeddingModel(){if(!this.pulling.embedding){this.pulling.embedding=!0;try{const t=await fetch(r+"/models/pull/embedding",{method:"POST"}),e=await t.json();if(!t.ok)throw new Error(e.error||"拉取向量化模型失败");e.warning?this.showNotification(e.message,"warning"):this.showNotification(e.message||"向量化模型拉取成功","success")}catch(t){console.error("拉取向量化模型失败:",t),this.showNotification("拉取失败: "+t.message,"error")}finally{this.pulling.embedding=!1}}},closeDetailsModal(){this.showDetailsModal=!1,this.selectedModelDetails=null},closeRenameModal(){this.showRenameModal=!1,this.selectedModel=null,this.newModelName="",this.renaming=!1},closeDeleteModal(){this.showDeleteModal=!1,this.selectedModel=null,this.deleting=!1},showNotification(t,e="success"){this.notification={show:!0,message:t,type:e},setTimeout(()=>{this.notification.show=!1},3e3)},formatDate(t){if(!t)return"未知";const e=new Date(1e3*t);return e.toLocaleString("zh-CN")}}},L=k,N=(s("b674"),Object(f["a"])(L,D,T,!1,null,"5eecd676",null)),S=N.exports,F=function(){var t=this,e=t._self._c;return e("div",{staticClass:"container"},[e("div",{staticClass:"header-section"},[t._m(0),e("button",{staticClass:"refresh-btn",attrs:{disabled:t.isUploading},on:{click:t.getCollections}},[e("i",{staticClass:"fa-solid fa-sync",class:{"fa-spin":t.isUploading}}),t._v(" 刷新 ")])]),e("div",{staticClass:"upload-section"},[e("div",{staticClass:"file-upload-container"},[e("label",{staticClass:"file-upload-button",class:{disabled:t.isUploading}},[e("input",{ref:"fileInput",attrs:{type:"file",accept:".txt,.pdf,.docx,.doc,.csv,.json",disabled:t.isUploading},on:{change:t.handleFileUpload}}),t.isUploading||t.uploadError?t._e():e("span",[e("i",{staticClass:"fa-solid fa-cloud-upload-alt"}),t._v(" "+t._s(t.fileName||"选择知识文件")+" ")]),t.isUploading?e("span",{staticClass:"uploading-text"},[e("i",{staticClass:"fa-solid fa-spinner fa-spin"}),t._v(" 正在处理中... ")]):t._e(),t.uploadError?e("span",{staticClass:"error-text"},[e("i",{staticClass:"fa-solid fa-exclamation-triangle"}),t._v(" "+t._s(t.uploadError)+" ")]):t._e()]),t.isUploading?e("div",{staticClass:"progress-container"},[e("div",{staticClass:"progress-bar",style:{width:t.progress+"%"}}),e("span",{staticClass:"progress-text"},[t._v(t._s(t.progress)+"%")])]):t._e()]),e("div",{staticClass:"upload-actions"},[e("button",{staticClass:"action-btn upload-btn",attrs:{disabled:!t.fileToUpload||t.isUploading},on:{click:t.uploadFile}},[e("i",{staticClass:"fa-solid fa-upload"}),t._v(" 添加到知识库 ")]),e("button",{staticClass:"action-btn clear-btn",attrs:{disabled:t.isUploading},on:{click:t.clearSelection}},[e("i",{staticClass:"fa-solid fa-times"}),t._v(" 清除 ")])])]),t.isUploading&&!t.uploadSuccess?e("div",{staticClass:"loading-section"},[e("i",{staticClass:"fa-solid fa-spinner fa-spin"}),t._v(" 处理中... ")]):t._e(),t.uploadSuccess?e("div",{staticClass:"success-message"},[e("i",{staticClass:"fa-solid fa-check-circle"}),t._v(" 文件 "),e("strong",[t._v(t._s(t.uploadedFileName))]),t._v(" 已成功添加到知识库！ ")]):t._e(),t._m(1),t.notification.show?e("div",{class:["notification",t.notification.type]},[e("i",{class:t.notificationIcon}),t._v(" "+t._s(t.notification.message)+" ")]):t._e()])},$=[function(){var t=this,e=t._self._c;return e("div",[e("h2",{staticClass:"section-title"},[e("i",{staticClass:"fa-solid fa-brain"}),t._v(" 知识库管理 ")])])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"format-info"},[e("h3",{staticClass:"sub-section-title"},[t._v("支持的文件格式")]),e("div",{staticClass:"format-list"},[e("div",{staticClass:"format-item"},[e("i",{staticClass:"fa-solid fa-file-alt"}),t._v(" TXT文本文件 ")]),e("div",{staticClass:"format-item"},[e("i",{staticClass:"fa-solid fa-file-pdf"}),t._v(" PDF文档 ")]),e("div",{staticClass:"format-item"},[e("i",{staticClass:"fa-solid fa-file-word"}),t._v(" Word文档 ")]),e("div",{staticClass:"format-item"},[e("i",{staticClass:"fa-solid fa-file-csv"}),t._v(" CSV数据文件 ")]),e("div",{staticClass:"format-item"},[e("i",{staticClass:"fa-solid fa-file-code"}),t._v(" JSON数据文件 ")])])])}],P=s("4c32"),E={name:"KnowledgeManage",data(){return{fileToUpload:null,fileName:"",isUploading:!1,uploadError:null,uploadSuccess:!1,uploadedFileName:"",progress:0,collections:[],notification:{show:!1,message:"",type:"success"},notificationTimer:null}},computed:{notificationIcon(){const t={success:"fa-solid fa-check-circle",error:"fa-solid fa-exclamation-circle",warning:"fa-solid fa-exclamation-triangle"};return t[this.notification.type]||t.success}},mounted(){this.getCollections()},methods:{handleFileUpload(t){const e=t.target.files;e.length>0&&(this.fileToUpload=e[0],this.fileName=e[0].name,this.uploadError=null,this.uploadSuccess=!1)},clearSelection(){this.fileToUpload=null,this.fileName="",this.uploadError=null,this.uploadSuccess=!1,this.progress=0,this.$refs.fileInput&&(this.$refs.fileInput.value="")},uploadFile(){if(!this.fileToUpload)return void this.showNotification("请先选择文件","warning");const t=["text/plain","application/pdf","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/msword","text/csv","application/json"];if(!t.includes(this.fileToUpload.type))return void this.showNotification("不支持的文件类型，请选择TXT、PDF、DOCX、DOC、CSV或JSON文件","error");this.isUploading=!0,this.uploadError=null,this.uploadSuccess=!1,this.progress=0;const e=new FormData;e.append("file",this.fileToUpload);const s=setInterval(()=>{this.progress<90&&(this.progress+=Math.floor(5*Math.random())+1)},300);P["a"].post(r+"/api/knowledge",e,{headers:{"Content-Type":"multipart/form-data"}}).then(t=>{clearInterval(s),this.progress=100,this.isUploading=!1,this.uploadSuccess=!0,this.uploadedFileName=this.fileName,this.clearSelection(),this.getCollections(),this.showNotification(`文件 ${this.uploadedFileName} 已成功添加到知识库！`,"success")}).catch(t=>{clearInterval(s),this.isUploading=!1,this.progress=0,console.error("文件上传错误:",t);let e="添加知识文件失败，请重试";t.response?(console.error("服务器响应错误:",t.response),e=t.response.data&&t.response.data.error?t.response.data.error:`服务器错误 (${t.response.status}): ${t.response.statusText}`):t.request?(console.error("请求未收到响应:",t.request),e="服务器没有响应，请检查网络连接或联系管理员"):(console.error("请求配置错误:",t.message),e="请求错误: "+t.message),this.uploadError=e,this.showNotification(e,"error")})},getCollections(){this.isUploading=!0,P["a"].get(r+"/api/knowledge/collections").then(t=>{t.data.success&&(this.collections=t.data.collections),this.isUploading=!1}).catch(t=>{console.error("获取知识库集合失败:",t),this.showNotification("获取知识库集合失败","error"),this.isUploading=!1})},showNotification(t,e="success",s=3e3){this.notificationTimer&&clearTimeout(this.notificationTimer),this.notification={show:!0,message:t,type:e},this.notificationTimer=setTimeout(()=>{this.notification.show=!1},s)}}},G=E,U=(s("c913"),Object(f["a"])(G,F,$,!1,null,"f0138d2a",null)),A=U.exports,O={data(){return{currentPage:"GeneVisualization"}},methods:{showPage(t){this.currentPage=t}},components:{GeneVisualization:p,SummaryReport:C,ModelTrain:x,ModelManage:S,KnowledgeManage:A}},j=O,I=(s("311e"),Object(f["a"])(j,i,o,!1,null,"c0fc9450",null)),B=I.exports;a["a"].config.productionTip=!1,new a["a"]({render:t=>t(B)}).$mount("#app")},"674c":function(t,e,s){},"6e0a":function(t,e,s){},"74f8":function(t,e,s){"use strict";s("b71d")},b674:function(t,e,s){"use strict";s("674c")},b71d:function(t,e,s){},c913:function(t,e,s){"use strict";s("e823")},cfdc:function(t,e,s){},dc18:function(t,e,s){},e823:function(t,e,s){},ea8d:function(t,e,s){"use strict";s("dc18")}});
//# sourceMappingURL=app.0ed858fe.js.map