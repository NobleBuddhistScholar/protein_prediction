(function(e){function t(t){for(var a,l,n=t[0],r=t[1],c=t[2],h=0,f=[];h<n.length;h++)l=n[h],Object.prototype.hasOwnProperty.call(i,l)&&i[l]&&f.push(i[l][0]),i[l]=0;for(a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a]);d&&d(t);while(f.length)f.shift()();return o.push.apply(o,c||[]),s()}function s(){for(var e,t=0;t<o.length;t++){for(var s=o[t],a=!0,n=1;n<s.length;n++){var r=s[n];0!==i[r]&&(a=!1)}a&&(o.splice(t--,1),e=l(l.s=s[0]))}return e}var a={},i={app:0},o=[];function l(t){if(a[t])return a[t].exports;var s=a[t]={i:t,l:!1,exports:{}};return e[t].call(s.exports,s,s.exports,l),s.l=!0,s.exports}l.m=e,l.c=a,l.d=function(e,t,s){l.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},l.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.t=function(e,t){if(1&t&&(e=l(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(l.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)l.d(s,a,function(t){return e[t]}.bind(null,a));return s},l.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return l.d(t,"a",t),t},l.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},l.p="/protein_prediction/";var n=window["webpackJsonp"]=window["webpackJsonp"]||[],r=n.push.bind(n);n.push=t,n=n.slice();for(var c=0;c<n.length;c++)t(n[c]);var d=r;o.push([0,"chunk-vendors"]),s()})({0:function(e,t,s){e.exports=s("56d7")},"56d7":function(e,t,s){"use strict";s.r(t);var a=s("2b0e"),i=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"app"}},[e._m(0),t("div",{staticClass:"main-container"},[t("div",{staticClass:"sidebar"},[t("button",{class:{active:"GeneVisualization"===e.currentPage},on:{click:function(t){return e.showPage("GeneVisualization")}}},[t("i",{staticClass:"fa-solid fa-flask-vial"}),e._v(" 基因组注释 ")]),t("button",{class:{active:"SummaryReport"===e.currentPage},on:{click:function(t){return e.showPage("SummaryReport")}}},[t("i",{staticClass:"fa-solid fa-folder-open"}),e._v(" 总报告管理 ")]),t("button",{class:{active:"ModelTrain"===e.currentPage},on:{click:function(t){return e.showPage("ModelTrain")}}},[t("i",{staticClass:"fa-solid fa-folder-open"}),e._v(" 模型训练 ")]),t("button",{class:{active:"ModelManage"===e.currentPage},on:{click:function(t){return e.showPage("ModelManage")}}},[t("i",{staticClass:"fa-solid fa-folder-open"}),e._v(" 模型管理 ")])]),t("div",{staticClass:"content"},[t("transition",{attrs:{name:"fade",mode:"out-in"}},[t(e.currentPage,{tag:"component"})],1)],1)])])},o=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"header"},[t("h1",[e._v("Virgenta")]),t("p",[e._v("基于HyperFusion cortex(HFC)的轻量病毒基因组注释系统-高效解析泛基因组非核心基因突变")]),t("p",[e._v("全自动预测病毒基因中的蛋白质序列并生成报告")])])}],l=function(){var e=this,t=e._self._c;return t("div",{staticClass:"container"},[t("div",{staticClass:"header-section"},[e._m(0),t("div",{staticClass:"model-select-container"},[t("label",{staticClass:"model-select-label"},[e._v("选择模型：")]),t("select",{directives:[{name:"model",rawName:"v-model",value:e.selectedModelFile,expression:"selectedModelFile"}],staticClass:"model-select",on:{change:function(t){var s=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.selectedModelFile=t.target.multiple?s:s[0]}}},e._l(e.modelOptions,(function(s){return t("option",{key:s.value,domProps:{value:s.value}},[e._v(" "+e._s(s.label)+" ")])})),0)]),t("div",{staticClass:"file-upload-container"},[t("label",{staticClass:"file-upload-button"},[t("input",{ref:"fileInput",attrs:{type:"file",accept:".fasta"},on:{change:e.handleFileUpload}}),e.isUploading||e.uploadError?e._e():t("span",[t("i",{staticClass:"icon-upload"}),e._v(" "+e._s(e.fileName||"选择FASTA文件")+" ")]),e.isUploading?t("span",{staticClass:"uploading-text"},[t("i",{staticClass:"fa-solid fa-spinner fa-spin"}),e._v(" 正在分析中... ")]):e._e(),e.uploadError?t("span",{staticClass:"error-text"},[t("i",{staticClass:"fa-solid fa-exclamation-triangle"}),e._v(" "+e._s(e.uploadError)+" ")]):e._e()]),e.isUploading?t("div",{staticClass:"progress-container"},[t("div",{staticClass:"progress-bar",style:{width:e.progress+"%"}}),t("span",{staticClass:"progress-text"},[e._v(e._s(e.progress)+"%")])]):e._e()])]),e.geneData?t("div",[e._m(1),t("div",{staticClass:"search-button-container"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.searchKeyword,expression:"searchKeyword"}],attrs:{type:"text",placeholder:"按蛋白类型搜索"},domProps:{value:e.searchKeyword},on:{input:[function(t){t.target.composing||(e.searchKeyword=t.target.value)},e.filterGenes]}}),t("div",{staticClass:"control-buttons"},[t("button",{on:{click:e.showReportModal}},[t("i",{staticClass:"fa-solid fa-table-list"}),e._v(" 查看txt报告 ")]),t("button",{on:{click:e.openGffReportModal}},[t("i",{staticClass:"fa-solid fa-file-alt"}),e._v(" 查看GFF报告 ")]),t("button",{on:{click:e.clearDetection}},[t("i",{staticClass:"fa-solid fa-power-off"}),e._v(" 关闭预测 ")])])]),t("div",{staticClass:"gene-visualization-wrapper"},[t("div",{ref:"rulerContainer",staticClass:"ruler-container",on:{mousemove:e.handleRulerHover,mouseleave:e.handleRulerLeave}},[t("canvas",{ref:"rulerCanvas",staticClass:"ruler-canvas"}),t("div",{staticClass:"gene-length-bar",style:{width:e.getScaledWidth(e.geneData.metadata.length)+"px"}}),e.showRulerTooltip?t("div",{staticClass:"ruler-tooltip",style:{left:e.rulerTooltipPos+"px"}},[e._v(" "+e._s(e.rulerTooltipText)+" ")]):e._e(),e.showRulerLine?t("div",{staticClass:"ruler-line",style:{left:e.rulerTooltipPos+"px"}}):e._e(),t("div",{ref:"geneRowsContainer",staticClass:"gene-rows-container",on:{scroll:e.handleScroll}},e._l(e.filteredGeneRows,(function(s,a){return t("div",{key:a,staticClass:"gene-row"},e._l(s,(function(s){return t("div",{key:s.location,staticClass:"gene-item",style:{left:e.getScaledPosition(e.getLeftPosition(s))+"px",width:e.getScaledWidth(e.getWidth(s))+"px",backgroundColor:e.getColor(s.type),zIndex:e.hoveredGene===s.location?10:1},on:{click:function(t){return e.showDetails(s)},mouseenter:function(t){return e.handleGeneHover(s)},mouseleave:function(t){return e.handleGeneLeave(s)}}},[t("span",{staticClass:"gene-type-label"},[e._v(" "+e._s(e.getGeneTypeLabel(s.type))+" ")]),e.hoveredGene===s.location?t("div",{staticClass:"gene-tooltip"},[t("div",[e._v(e._s(s.type))]),t("div",[e._v("位置: "+e._s(s.location))])]):e._e()])})),0)})),0)]),e.showGeneDetailsModal?t("div",{staticClass:"modal"},[t("div",{staticClass:"modal-content"},[t("span",{staticClass:"close",on:{click:e.closeGeneDetailsModal}},[e._v("×")]),t("h3",{staticClass:"modal-title"},[e._v("基因详细信息")]),t("div",{staticClass:"gene-details"},[t("div",{staticClass:"detail-row"},[t("div",{staticClass:"detail-label"},[e._v("基因ID:")]),t("div",{staticClass:"detail-value"},[e._v(e._s(e.currentGeneDetails.location))])]),t("div",{staticClass:"detail-row"},[t("div",{staticClass:"detail-label"},[e._v("基因类型:")]),t("div",{staticClass:"detail-value"},[e._v(e._s(e.currentGeneDetails.type))])]),t("div",{staticClass:"detail-row"},[t("div",{staticClass:"detail-label"},[e._v("位置:")]),t("div",{staticClass:"detail-value"},[e._v(e._s(e.currentGeneDetails.location))])]),t("div",{staticClass:"detail-row"},[t("div",{staticClass:"detail-label"},[e._v("长度:")]),t("div",{staticClass:"detail-value"},[e._v(e._s(e.getWidth(e.currentGeneDetails)))])])])])]):e._e(),e.showTxtReportModal?t("div",{staticClass:"modal"},[t("div",{staticClass:"modal-content"},[t("div",{staticClass:"modal-header"},[t("h3",{staticClass:"modal-title"},[e._v("TXT 分析报告")]),t("button",{staticClass:"modal-download",on:{click:e.downloadTxtReport}},[t("i",{staticClass:"fa-solid fa-download"}),e._v(" 下载 ")]),t("span",{staticClass:"close",on:{click:e.closeTxtReportModal}},[e._v("×")])]),t("div",{staticClass:"report-content",domProps:{innerHTML:e._s(e.formatContent(e.txtReportContent))}})])]):e._e(),e.showGffReportModal?t("div",{staticClass:"modal"},[t("div",{staticClass:"modal-content"},[t("div",{staticClass:"modal-header"},[t("h3",{staticClass:"modal-title"},[e._v("GFF报告")]),t("button",{staticClass:"modal-download",on:{click:e.downloadGffReport}},[t("i",{staticClass:"fa-solid fa-download"}),e._v(" 下载 ")]),t("span",{staticClass:"close",on:{click:e.closeGffReportModal}},[e._v("×")])]),t("div",{staticClass:"gff-modal-content",domProps:{innerHTML:e._s(e.gffReport)}})])]):e._e(),t("div",{staticClass:"ai-report-panel"},[t("div",{staticClass:"ai-report-panel-header"},[t("i",{staticClass:"fa-solid fa-robot"}),e._v(" AI分析报告 "),t("button",{staticClass:"ai-report-regenerate",attrs:{disabled:e.isUploading||!e.geneData},on:{click:e.handleStreamSummary}},[t("i",{staticClass:"fa-solid fa-rotate"}),e._v(" 重新生成 ")])]),t("div",{ref:"aiReportPanelBody",staticClass:"ai-report-panel-body"},[e.isUploading&&!e.currentReport?t("div",{staticClass:"ai-report-loading"},[t("i",{staticClass:"fa-solid fa-spinner fa-spin"}),e._v(" 正在生成AI分析报告... ")]):e.uploadError?t("div",{staticClass:"ai-report-error"},[t("i",{staticClass:"fa-solid fa-exclamation-triangle"}),e._v(" "+e._s(e.uploadError)+" ")]):e.currentReport?t("div",{domProps:{innerHTML:e._s(e.formatContent(e.currentReport))}}):t("div",{staticClass:"ai-report-empty"},[e._v(" 暂无AI分析报告，请点击上方按钮生成。 "),e.geneData?t("div",{staticClass:"ai-report-empty-tip"},[e._v(' 可以点击"重新生成"按钮来获取关于此基因组的AI分析报告。 ')]):t("div",{staticClass:"ai-report-empty-tip"},[e._v(" 请先上传基因组数据。 ")])])])])])]):e._e()])},n=[function(){var e=this,t=e._self._c;return t("h2",{staticClass:"section-title"},[t("i",{staticClass:"fa-solid fa-microscope"}),e._v(" 基因组注释 ")])},function(){var e=this,t=e._self._c;return t("h3",{staticClass:"gene-visualization-title"},[t("i",{staticClass:"fa-solid fa-dna"}),e._v(" 基因组图谱 ")])}],r={data(){return{reportInfo:{genome_id:"",report_date:""},geneData:null,currentReport:null,savedGeneData:null,showLocationTooltip:!1,locationTooltip:"",geneRows:[],showGeneDetailsModal:!1,currentGeneDetails:{},scaleFactor:.035,fileName:"",isUploading:!1,progress:0,progressInterval:null,hoveredGene:null,showRulerTooltip:!1,rulerTooltipPos:0,rulerTooltipText:"",showRulerLine:!0,searchKeyword:"",filteredGeneRows:[],showGffReportModal:!1,gffReport:null,isGeneratingGff:!1,uploadError:null,selectedModelFile:"HyperFusionCortex_v1.pth",modelOptions:[],showTxtReportModal:!1,txtReportContent:""}},computed:{formattedReport(){return this.currentReport?this.formatContent(this.currentReport):""}},watch:{geneData(){this.$nextTick(()=>{this.drawRuler()})},currentReport(){this.$nextTick(()=>{this.scrollToBottom()})}},mounted(){this.geneData&&this.drawRuler(),this.loadModelList()},methods:{async loadModelList(){try{const e=await fetch("http://localhost:5000/models");if(!e.ok)throw new Error("获取模型列表失败");const t=await e.json();this.modelOptions=t.models.map(e=>({value:e.filename,label:e.display_name+(e.description?` (${e.description})`:"")})),this.modelOptions.length>0&&!this.modelOptions.find(e=>e.value===this.selectedModelFile)&&(this.selectedModelFile=this.modelOptions[0].value)}catch(e){console.error("加载模型列表失败:",e),this.modelOptions=[{value:"HyperFusionCortex_v1.pth",label:"HyperFusionCortex v1"}]}},drawRuler(){const e=this.$refs.rulerCanvas;if(!e||!this.geneData)return;const t=e.getContext("2d"),s=this.geneData.metadata.length,a=this.getScaledWidth(s);e.width=a,e.height=30,e.style.width=a+"px",e.style.height="30px",t.clearRect(0,0,e.width,e.height),t.strokeStyle="#666",t.fillStyle="#666",t.font="10px Arial",t.textAlign="center";for(let i=0;i<=s;i+=1e3){const e=this.getScaledPosition(i);t.beginPath(),t.moveTo(e,0),t.lineTo(e,15),t.stroke(),t.fillText(i/1e3+"k",e,25)}t.strokeStyle="#999";for(let i=0;i<=s;i+=500){if(i%1e3===0)continue;const e=this.getScaledPosition(i);t.beginPath(),t.moveTo(e,5),t.lineTo(e,10),t.stroke()}},handleRulerHover(e){const t=e.currentTarget,s=t.getBoundingClientRect(),a=e.clientX-s.left,i=Math.round(a/this.scaleFactor);this.rulerTooltipPos=a,this.rulerTooltipText=i,this.showRulerTooltip=!0,this.showRulerLine=!0},handleRulerLeave(){this.showRulerTooltip=!1,this.showRulerLine=!1},handleGeneHover(e){this.hoveredGene=e.location},handleGeneLeave(e){this.hoveredGene=null},handleScroll(){const e=this.$refs.geneRowsContainer,t=this.$refs.rulerContainer;e&&t&&(t.scrollLeft=e.scrollLeft)},async handleFileUpload(e){const t=e.target.files[0];if(!t)return;this.fileName=t.name,this.isUploading=!0,this.progress=0,this.uploadError=null,this.$refs.rulerCanvas&&this.drawRuler(),this.progressInterval=setInterval(()=>{this.progress<90&&(this.progress+=2*Math.random())},1e3);const s=new FormData;s.append("file",t),s.append("model_file",this.selectedModelFile);try{const e=await fetch("http://localhost:5000/upload",{method:"POST",body:s});if(!e.ok)throw new Error("上传失败");const t=await e.json();this.geneData=t.results,this.currentReport=t.summary,this.processGeneRows();let a="";a=t.summary&&t.summary.filename?t.summary.filename:t.summary?Object.keys(t.summary)[0]:t.filename?t.filename:"";const[i,o]=this.parseFilename(a);this.reportInfo={genome_id:i,report_date:o},this.progress=100,setTimeout(async()=>{this.isUploading=!1,clearInterval(this.progressInterval),setTimeout(()=>{this.geneData&&!this.currentReport&&(console.log("自动开始生成AI分析报告..."),this.handleStreamSummary())},1e3)},500)}catch(a){console.error("Error:",a),this.uploadError="文件处理失败: "+a.message,this.isUploading=!1,clearInterval(this.progressInterval),alert("文件处理失败: "+a.message)}},parseFilename(e){const t=/(.+)_基因组分析报告_(\d{4}-\d{2}-\d{2})\.txt/,s=e.match(t);return s?[s[1],s[2]]:["",""]},async showReportModal(){if(this.geneData)try{const e=this.geneData.metadata.genome_id,t=(new Date).toISOString().split("T")[0],s=`http://localhost:5000/summary?genome_id=${e}&current_date=${t}`,a=await fetch(s);if(!a.ok)throw new Error("报告获取失败");const i=await a.json(),o=i[Object.keys(i)[0]];this.txtReportContent=o,this.showTxtReportModal=!0,this.reportInfo={genome_id:e,report_date:t}}catch(e){console.error("TXT报告加载失败:",e),this.txtReportContent="无法加载报告内容："+e.message,this.showTxtReportModal=!0}else alert("没有基因组数据，无法显示报告")},closeTxtReportModal(){this.showTxtReportModal=!1},downloadTxtReport(){if(!this.txtReportContent)return;const{genome_id:e,report_date:t}=this.reportInfo,s=`${e||"report"}_基因组分析报告_${t||""}.txt`,a=new Blob([this.txtReportContent],{type:"text/plain"}),i=URL.createObjectURL(a),o=document.createElement("a");o.href=i,o.download=s,o.click(),URL.revokeObjectURL(i)},async openGffReportModal(){this.showGffReportModal=!0,this.isGeneratingGff=!0;try{const e=this.geneData.metadata.genome_id,t=(new Date).toISOString().split("T")[0],s=await fetch(`http://localhost:5000/generate_gff?genome_id=${e}&current_date=${t}`);if(!s.ok)throw new Error("生成GFF报告失败");const a=await fetch(`http://localhost:5000/gff?genome_id=${e}&current_date=${t}`);if(!a.ok)throw new Error("获取GFF报告失败");const i=await a.json();this.gffReport=i[Object.keys(i)[0]]}catch(e){console.error("GFF报告处理失败:",e),this.gffReport="无法加载GFF报告内容："+e.message}finally{this.isGeneratingGff=!1}},closeGffReportModal(){this.showGffReportModal=!1},clearDetection(){this.geneData=null,this.currentReport=null,this.savedGeneData=null,this.$refs.fileInput.value="",this.fileName="",this.uploadError=null,this.gffReport=null},formatContent(e){const t=e.replace(/[*#]/g,""),s=t.split("\n");let a=[],i=[],o=!1;return s.forEach(e=>{e=e.trim();const t=/^\|.+?\|$/.test(e);t?(o||(o=!0),i.push(e)):(o&&(a.push(this.processTable(i)),i=[],o=!1),a.push(this.processTextLine(e)))}),a.join("")},processTextLine(e){return e=e.replace(/[*#]/g,""),/^\d+\.\s/.test(e)?`<h3>${e.replace(/^\d+\.\s/,"")}</h3>`:/^- /.test(e)?`<li>${e.replace(/^- /,"")}</li>`:e?`<p>${e}</p>`:""},processTable(e){if(e.length<2)return"";const t=e[0].split("|").slice(1,-1).map(e=>e.trim()),s=e.slice(2);let a='<table class="summary-table"><thead><tr>';return t.forEach(e=>a+=`<th>${e}</th>`),a+="</tr></thead><tbody>",s.forEach(e=>{const t=e.split("|").slice(1,-1).map(e=>e.trim());a+="<tr>",t.forEach(e=>a+=`<td>${e}</td>`),a+="</tr>"}),a+"</tbody></table>"},getColor(e){const t={NSP1:"#FF6B6B",NSP2:"#4ECDC4",NSP3:"#45B7D1",NSP4:"#FFBE0B",NSP5:"#FB5607",NSP6:"#8338EC",NSP7:"#3A86FF",NSP8:"#FF006E",NSP9:"#88D18A",NSP10:"#118AB2",NSP11:"#8A89C0",NSP12:"#EF476F",NSP13:"#06D6A0",NSP14:"#1B9AAA",NSP15:"#FFC43D",NSP16:"#8A89b0",membrane_protein:"#E2F0F9",envelope_protein:"#FCD5CE",nucleocapsid_protein:"#FFF1CC"};return t[e]||"#CCCCCC"},showDetails(e){this.currentGeneDetails=e,this.showGeneDetailsModal=!0},showLocation(e){this.showLocationTooltip=!0,this.locationTooltip=e},hideLocation(){this.showLocationTooltip=!1},processGeneRows(){this.geneRows=[];const e={};this.geneData.features.forEach(t=>{if(!e[t.location]){e[t.location]=t;let s=!1;for(let e=0;e<this.geneRows.length;e++)if(!this.hasOverlap(this.geneRows[e],t)){this.geneRows[e].push(t),s=!0;break}s||this.geneRows.push([t])}}),this.filterGenes()},filterGenes(){if(!this.searchKeyword)return void(this.filteredGeneRows=JSON.parse(JSON.stringify(this.geneRows)));const e=this.searchKeyword.toLowerCase().trim();this.filteredGeneRows=this.geneRows.map(t=>t.filter(t=>t.type.toLowerCase().includes(e))).filter(e=>e.length>0)},hasOverlap(e,t){const[s,a]=t.location.split("..").map(Number);return e.some(e=>{const[t,i]=e.location.split("..").map(Number);return s<i&&a>t})},getScaledWidth(e){return e*this.scaleFactor},getScaledPosition(e){return e*this.scaleFactor},getLeftPosition(e){return parseInt(e.location.split("..")[0])},getWidth(e){const[t,s]=e.location.split("..").map(Number);return s-t},closeGeneDetailsModal(){this.showGeneDetailsModal=!1},getGeneTypeLabel(e){switch(e){case"membrane_protein":return"M";case"spike_protein":return"S";case"envelope_protein":return"E";case"nucleocapsid_protein":return"N";default:return e}},downloadGffReport(){if(this.gffReport){const{genome_id:e,report_date:t}=this.reportInfo,s=`${e||"gff"}_annotation_${t||""}.gff`,a=new Blob([this.gffReport],{type:"text/plain"}),i=URL.createObjectURL(a),o=document.createElement("a");o.href=i,o.download=s,o.click(),URL.revokeObjectURL(i)}},async streamSummary(e,t){this.isUploading=!0,this.currentReport="",this.uploadError=null;try{const s={genome_id:e,genome_data:t},a=await fetch("http://localhost:5000/stream_summary",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!a.ok)throw new Error(`服务器响应错误: ${a.status} ${a.statusText}`);if(!a.body)throw new Error("流式接口无响应体");const i=a.body.getReader(),o=new TextDecoder("utf-8");let l=!1;this.currentReport="";while(!l){const{value:e,done:t}=await i.read();l=t;let s="";if(e){if(s=o.decode(e,{stream:!l}),s.startsWith("[ERROR]"))throw new Error(s.substring(7));this.currentReport+=s,await this.$nextTick(),this.scrollToBottom()}}}catch(s){this.uploadError="AI分析失败: "+s.message,this.currentReport="生成报告时出错: "+s.message}finally{this.isUploading=!1,await this.$nextTick(),this.scrollToBottom()}},async handleStreamSummary(){if(!this.geneData)return console.error("没有基因数据，无法生成报告"),void(this.uploadError="请先上传基因组数据");this.currentReport="",this.uploadError=null;try{console.log("开始生成AI分析报告...");const e=this.geneData.metadata.genome_id||"unknown";await this.streamSummary(e,this.geneData)}catch(e){console.error("处理流式分析时出错:",e),this.uploadError="AI分析失败: "+e.message,this.currentReport="生成报告失败: "+e.message}},scrollToBottom(){const e=this.$refs.aiReportPanelBody;e&&(console.log("滚动到底部, 高度:",e.scrollHeight),e.scrollTop=e.scrollHeight)}}},c=r,d=(s("b5d1"),s("2877")),h=Object(d["a"])(c,l,n,!1,null,"327c7932",null),f=h.exports,m=function(){var e=this,t=e._self._c;return t("div",{staticClass:"container"},[t("div",{staticClass:"header-section"},[e._m(0),t("button",{staticClass:"refresh-btn",attrs:{disabled:e.loading},on:{click:e.loadReports}},[t("i",{staticClass:"fa-solid fa-sync",class:{"fa-spin":e.loading}}),e._v(" 刷新 ")])]),t("div",{staticClass:"search-section"},[t("div",{staticClass:"search-container"},[t("i",{staticClass:"fa-solid fa-search search-icon"}),t("input",{directives:[{name:"model",rawName:"v-model",value:e.searchId,expression:"searchId"}],staticClass:"search-input",attrs:{placeholder:"按基因组ID搜索报告..."},domProps:{value:e.searchId},on:{input:function(t){t.target.composing||(e.searchId=t.target.value)}}})]),t("div",{staticClass:"report-count"},[e._v(" 共 "+e._s(e.filteredReports.length)+" 个报告 ")])]),e.loading?t("div",{staticClass:"loading-section"},[t("i",{staticClass:"fa-solid fa-spinner fa-spin"}),e._v(" 加载中... ")]):e._e(),e.error?t("div",{staticClass:"error-section"},[t("i",{staticClass:"fa-solid fa-exclamation-triangle"}),e._v(" "+e._s(e.error)+" ")]):e._e(),e.loading||e.error?e._e():t("div",{staticClass:"report-grid"},[e._l(e.filteredReports,(function(s,a){return t("div",{key:a,staticClass:"report-card"},[t("div",{staticClass:"report-card-header"},[e._m(1,!0),t("div",{staticClass:"report-info"},[t("h3",{staticClass:"report-name"},[e._v(e._s(s.genome_id))]),t("p",{staticClass:"report-date"},[e._v(e._s(e.formatDate(s.current_date)))])])]),t("div",{staticClass:"report-card-body"},[t("div",{staticClass:"report-filename"},[t("i",{staticClass:"fa-solid fa-file"}),e._v(" "+e._s(s.filename)+" ")])]),t("div",{staticClass:"report-card-actions"},[t("button",{staticClass:"action-btn view-btn",attrs:{disabled:e.actionLoading[s.filename]},on:{click:function(t){return e.showReport(s)}}},[t("i",{staticClass:"fa-solid fa-eye"}),e._v(" 查看 ")]),t("button",{staticClass:"action-btn details-btn",attrs:{disabled:e.actionLoading[s.filename]},on:{click:function(t){return e.viewReportDetails(s.filename)}}},[t("i",{staticClass:"fa-solid fa-info-circle"}),e._v(" 详情 ")]),t("button",{staticClass:"action-btn download-btn",attrs:{disabled:e.actionLoading[s.filename]},on:{click:function(t){return e.downloadReport(s)}}},[t("i",{staticClass:"fa-solid fa-download"}),e._v(" 下载TXT ")]),t("button",{staticClass:"action-btn gff-btn",attrs:{disabled:e.actionLoading[s.filename]},on:{click:function(t){return e.downloadGFFReport(s)}}},[t("i",{staticClass:"fa-solid fa-file-code"}),e._v(" 下载GFF ")]),t("button",{staticClass:"action-btn delete-btn",attrs:{disabled:e.actionLoading[s.filename]},on:{click:function(t){return e.showDeleteDialog(s)}}},[t("i",{staticClass:"fa-solid fa-trash"}),e._v(" 删除 ")])]),e.actionLoading[s.filename]?t("div",{staticClass:"action-loading"},[t("i",{staticClass:"fa-solid fa-spinner fa-spin"})]):e._e()])})),0===e.filteredReports.length?t("div",{staticClass:"empty-state"},[t("i",{staticClass:"fa-solid fa-folder-open"}),t("h3",[e._v("没有找到报告")]),e.searchId?t("p",[e._v("尝试修改搜索关键词")]):t("p",[e._v("暂无基因组分析报告")])]):e._e()],2),e.selectedReport?t("div",{staticClass:"modal-overlay",on:{click:e.closeReport}},[t("div",{staticClass:"modal-content report-modal",on:{click:function(e){e.stopPropagation()}}},[t("div",{staticClass:"modal-header"},[e._m(2),t("button",{staticClass:"close-btn",on:{click:e.closeReport}},[t("i",{staticClass:"fa-solid fa-times"})])]),t("div",{staticClass:"modal-body"},[e.summary?t("div",{staticClass:"report-content",domProps:{innerHTML:e._s(e.formattedSummary)}}):t("div",{staticClass:"loading-details"},[t("i",{staticClass:"fa-solid fa-spinner fa-spin"}),e._v(" 加载报告中... ")])])])]):e._e(),e.showDetailsModal?t("div",{staticClass:"modal-overlay",on:{click:e.closeDetailsModal}},[t("div",{staticClass:"modal-content details-modal",on:{click:function(e){e.stopPropagation()}}},[t("div",{staticClass:"modal-header"},[e._m(3),t("button",{staticClass:"close-btn",on:{click:e.closeDetailsModal}},[t("i",{staticClass:"fa-solid fa-times"})])]),t("div",{staticClass:"modal-body"},[e.selectedReportDetails?t("div",{staticClass:"details-grid"},[t("div",{staticClass:"detail-item"},[t("label",[e._v("文件名:")]),t("span",[e._v(e._s(e.selectedReportDetails.filename))])]),t("div",{staticClass:"detail-item"},[t("label",[e._v("基因组ID:")]),t("span",[e._v(e._s(e.selectedReportDetails.genome_id))])]),t("div",{staticClass:"detail-item"},[t("label",[e._v("分析日期:")]),t("span",[e._v(e._s(e.selectedReportDetails.analysis_date))])]),t("div",{staticClass:"detail-item"},[t("label",[e._v("文件大小:")]),t("span",[e._v(e._s(e.selectedReportDetails.file_size))])]),t("div",{staticClass:"detail-item"},[t("label",[e._v("最后修改:")]),t("span",[e._v(e._s(e.formatTimestamp(e.selectedReportDetails.last_modified)))])])]):t("div",{staticClass:"loading-details"},[t("i",{staticClass:"fa-solid fa-spinner fa-spin"}),e._v(" 加载详情中... ")])])])]):e._e(),e.showDeleteModal?t("div",{staticClass:"modal-overlay",on:{click:e.closeDeleteModal}},[t("div",{staticClass:"modal-content delete-modal",on:{click:function(e){e.stopPropagation()}}},[t("div",{staticClass:"modal-header"},[e._m(4),t("button",{staticClass:"close-btn",on:{click:e.closeDeleteModal}},[t("i",{staticClass:"fa-solid fa-times"})])]),t("div",{staticClass:"modal-body"},[t("p",[e._v("确定要删除报告 "),t("strong",[e._v(e._s(e.selectedReportForDelete&&e.selectedReportForDelete.filename))]),e._v(" 吗？")]),t("p",{staticClass:"warning-text"},[e._v("此操作将同时删除相关的JSON和GFF文件，且不可撤销。")])]),t("div",{staticClass:"modal-footer"},[t("button",{staticClass:"btn btn-secondary",on:{click:e.closeDeleteModal}},[e._v("取消")]),t("button",{staticClass:"btn btn-danger",attrs:{disabled:e.deleting},on:{click:e.confirmDelete}},[e.deleting?t("i",{staticClass:"fa-solid fa-spinner fa-spin"}):e._e(),e._v(" "+e._s(e.deleting?"删除中...":"确认删除")+" ")])])])]):e._e(),e.notification.show?t("div",{class:["notification",e.notification.type]},[t("i",{class:e.notificationIcon}),e._v(" "+e._s(e.notification.message)+" ")]):e._e()])},p=[function(){var e=this,t=e._self._c;return t("h2",{staticClass:"section-title"},[t("i",{staticClass:"fa-solid fa-file-chart-line"}),e._v(" 基因组分析报告 ")])},function(){var e=this,t=e._self._c;return t("div",{staticClass:"report-icon"},[t("i",{staticClass:"fa-solid fa-chart-line"})])},function(){var e=this,t=e._self._c;return t("h3",[t("i",{staticClass:"fa-solid fa-file-chart-line"}),e._v(" 分析报告")])},function(){var e=this,t=e._self._c;return t("h3",[t("i",{staticClass:"fa-solid fa-info-circle"}),e._v(" 报告详情")])},function(){var e=this,t=e._self._c;return t("h3",[t("i",{staticClass:"fa-solid fa-exclamation-triangle text-danger"}),e._v(" 删除报告")])}];const u="http://localhost:5000";var v={data(){return{reports:[],selectedReport:null,summary:null,searchId:"",loading:!1,error:null,actionLoading:{},showDetailsModal:!1,showDeleteModal:!1,selectedReportDetails:null,selectedReportForDelete:null,deleting:!1,notification:{show:!1,message:"",type:"success"}}},computed:{formattedSummary(){if(!this.summary)return"";const e=this.summary.replace(/[*#]/g,""),t=e.split("\n"),s=t.reduce((e,t)=>{t=t.trim();const s=/^\|.*\|$/.test(t);if(s)e.tableRows.push(t),e.inTable=!0;else{if(e.inTable){const t=this.processTable(e.tableRows);e.htmlArray.push(t),e.tableRows=[],e.inTable=!1}let s=this.processTextLine(t);s&&e.htmlArray.push(s)}return e},{inTable:!1,tableRows:[],htmlArray:[]});if(s.inTable){const e=this.processTable(s.tableRows);s.htmlArray.push(e)}let a=s.htmlArray.join("").replace(/<li>/g,"<ul><li>").replace(/<\/li>/g,"</li></ul>").replace(/<\/ul><ul>/g,"");return a},filteredReports(){if(!this.searchId.trim())return this.reports;const e=this.searchId.toLowerCase().trim();return this.reports.filter(t=>t.genome_id.toLowerCase().includes(e)||t.filename.toLowerCase().includes(e))},notificationIcon(){const e={success:"fa-solid fa-check-circle",error:"fa-solid fa-exclamation-circle",warning:"fa-solid fa-exclamation-triangle"};return e[this.notification.type]||e.success}},mounted(){this.loadReports()},methods:{async loadReports(){this.loading=!0,this.error=null;try{const e=await fetch(u+"/getAllSummaries");if(!e.ok)throw new Error(`HTTP ${e.status}: ${e.statusText}`);const t=await e.json();this.reports=t.map(e=>{const t=e.split("_基因组分析报告_");if(2===t.length){const s=t[0],a=t[1].replace(".txt","");return{filename:e,genome_id:s,current_date:a}}return null}).filter(e=>null!==e),this.actionLoading={}}catch(e){console.error("加载报告列表失败:",e),this.error=e.message||"加载报告列表失败",this.reports=[]}finally{this.loading=!1}},async showReport(e){if(e&&e.filename){this.setActionLoading(e.filename,!0);try{const{genome_id:t,current_date:s}=e,a=await fetch(`${u}/summary?genome_id=${t}&current_date=${s}`);if(!a.ok)throw new Error("获取报告内容失败: "+a.statusText);const i=await a.json();this.summary=Object.values(i)[0],this.selectedReport=e.filename}catch(t){console.error("获取报告内容失败:",t),this.showNotification("获取报告内容失败: "+t.message,"error")}finally{this.setActionLoading(e.filename,!1)}}else this.showNotification("报告信息不完整或文件名未定义","error")},async viewReportDetails(e){this.setActionLoading(e,!0);try{const t=await fetch(`${u}/reports/${e}/details`);if(!t.ok)throw new Error("获取报告详情失败: "+t.statusText);this.selectedReportDetails=await t.json(),this.showDetailsModal=!0}catch(t){console.error("获取报告详情失败:",t),this.showNotification("获取报告详情失败: "+t.message,"error")}finally{this.setActionLoading(e,!1)}},async downloadReport(e){this.setActionLoading(e.filename,!0);try{const{genome_id:t,current_date:s}=e,a=await fetch(`${u}/summary?genome_id=${t}&current_date=${s}`);if(!a.ok)throw new Error("获取报告内容失败: "+a.statusText);const i=await a.json(),o=Object.values(i)[0],l=document.createElement("a");l.href=URL.createObjectURL(new Blob([o.replace(/[*#]/g,"")],{type:"text/plain"})),l.download=e.filename,l.click(),this.showNotification("报告下载成功","success")}catch(t){console.error("下载报告失败:",t),this.showNotification("下载报告失败: "+t.message,"error")}finally{this.setActionLoading(e.filename,!1)}},async downloadGFFReport(e){this.setActionLoading(e.filename,!0);try{const{genome_id:t,current_date:s}=e,a=`${t}_annotation_${s}.gff`,i=await fetch(`${u}/gff?genome_id=${t}&current_date=${s}`);if(!i.ok)throw new Error("获取GFF报告失败: "+i.statusText);const o=await i.json(),l=o[a],n=l.replace(/(\S+)\s+(\S+)\s+(\S+)\s+(\S+)\s+(\S+)\s+(\S+)\s+(\S+)\s+(\S+)\s+(.+)/g,"$1\t$2\t$3\t$4\t$5\t$6\t$7\t$8\t$9"),r=new Blob([n],{type:"text/plain"}),c=window.URL.createObjectURL(r),d=document.createElement("a");d.href=c,d.download=a,d.click(),window.URL.revokeObjectURL(c),this.showNotification("GFF报告下载成功","success")}catch(t){console.error("下载GFF报告失败:",t),this.showNotification("下载GFF报告失败: "+t.message,"error")}finally{this.setActionLoading(e.filename,!1)}},showDeleteDialog(e){this.selectedReportForDelete=e,this.showDeleteModal=!0},async confirmDelete(){if(!this.deleting){this.deleting=!0;try{const e=await fetch(`${u}/reports/${this.selectedReportForDelete.filename}`,{method:"DELETE"});if(!e.ok){const t=await e.json();throw new Error(t.error||"删除失败")}this.showNotification("报告删除成功","success"),this.closeDeleteModal(),this.loadReports()}catch(e){console.error("删除报告失败:",e),this.showNotification("删除失败: "+e.message,"error")}finally{this.deleting=!1}}},processTextLine(e){return e=e.replace(/[*#]/g,""),/^\d+\.\s/.test(e)?`<h3>${e.replace(/^\d+\.\s/,"")}</h3>`:/^- /.test(e)?`<li>${e.replace(/^- /,"")}</li>`:e?`<p>${e}</p>`:""},processTable(e){if(e.length<2)return"";const t=e[0].split("|").slice(1,-1).map(e=>e.trim().replace(/[*#]/g,"")),s=e.slice(2).map(e=>e.split("|").slice(1,-1).map(e=>e.trim().replace(/[*#]/g,"")));let a='<table class="summary-table"><thead><tr>';return t.forEach(e=>{a+=`<th>${e}</th>`}),a+="</tr></thead><tbody>",s.forEach(e=>{a+="<tr>",e.forEach(e=>{a+=`<td>${e}</td>`}),a+="</tr>"}),a+"</tbody></table>"},downloadSummary(){if(this.summary){const e=document.createElement("a");e.href=URL.createObjectURL(new Blob([this.summary.replace(/[*#]/g,"")],{type:"text/plain"})),e.download=this.selectedReport,e.click(),this.showNotification("报告下载成功","success")}},setActionLoading(e,t){this.$set(this.actionLoading,e,t)},closeReport(){this.selectedReport=null,this.summary=null},closeDetailsModal(){this.showDetailsModal=!1,this.selectedReportDetails=null},closeDeleteModal(){this.showDeleteModal=!1,this.selectedReportForDelete=null,this.deleting=!1},showNotification(e,t="success"){this.notification={show:!0,message:e,type:t},setTimeout(()=>{this.notification.show=!1},3e3)},formatDate(e){if(!e)return"未知";const t=new Date(e);return isNaN(t.getTime())?e:t.toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric"})},formatTimestamp(e){if(!e)return"未知";const t=new Date(1e3*e);return t.toLocaleString("zh-CN")}}},_=v,g=(s("e33e"),Object(d["a"])(_,m,p,!1,null,"8a675cba",null)),w=g.exports,C=function(){var e=this,t=e._self._c;return t("div",{staticClass:"container gradient-bg"},[e._m(0),t("div",{staticClass:"form-row-flex card"},[t("div",{staticClass:"form-col"},[t("label",{staticClass:"form-label"},[e._v("选择已有模型（可选）：")]),t("select",{directives:[{name:"model",rawName:"v-model",value:e.selectedModel,expression:"selectedModel"}],staticClass:"form-select",on:{change:function(t){var s=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.selectedModel=t.target.multiple?s:s[0]}}},[t("option",{attrs:{value:""}},[e._v("不使用预训练")]),e._l(e.modelList,(function(s){return t("option",{key:s,domProps:{value:s}},[e._v(e._s(s))])}))],2)]),t("div",{staticClass:"form-divider"}),t("div",{staticClass:"form-col"},[t("label",{staticClass:"form-label"},[e._v("上传数据集：")]),t("div",{staticClass:"file-upload-container"},[e._m(1),t("input",{staticClass:"form-file",attrs:{id:"file-upload",type:"file",accept:".fasta,.fa",webkitdirectory:"",multiple:""},on:{change:e.handleFileChange}}),e.fileName?t("span",{staticClass:"file-name"},[e._v(e._s(e.fileName))]):e._e()])])]),t("div",{staticClass:"form-row card",staticStyle:{"flex-wrap":"wrap",gap:"1.5rem"}},[t("div",[t("label",[e._v("max_length：")]),t("input",{directives:[{name:"model",rawName:"v-model.number",value:e.form.max_length,expression:"form.max_length",modifiers:{number:!0}}],staticClass:"input-beauty",staticStyle:{width:"90px"},attrs:{type:"number",min:"100",max:"100000",step:"100"},domProps:{value:e.form.max_length},on:{input:function(t){t.target.composing||e.$set(e.form,"max_length",e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}})]),t("div",[t("label",[e._v("batch_size：")]),t("input",{directives:[{name:"model",rawName:"v-model.number",value:e.form.batch_size,expression:"form.batch_size",modifiers:{number:!0}}],staticClass:"input-beauty",staticStyle:{width:"70px"},attrs:{type:"number",min:"1",max:"1024",step:"1"},domProps:{value:e.form.batch_size},on:{input:function(t){t.target.composing||e.$set(e.form,"batch_size",e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}})]),t("div",[t("label",[e._v("epochs：")]),t("input",{directives:[{name:"model",rawName:"v-model.number",value:e.form.epochs,expression:"form.epochs",modifiers:{number:!0}}],staticClass:"input-beauty",staticStyle:{width:"60px"},attrs:{type:"number",min:"1",max:"1000",step:"1"},domProps:{value:e.form.epochs},on:{input:function(t){t.target.composing||e.$set(e.form,"epochs",e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}})]),t("div",[t("label",[e._v("learning_rate：")]),t("input",{directives:[{name:"model",rawName:"v-model.number",value:e.form.learning_rate,expression:"form.learning_rate",modifiers:{number:!0}}],staticClass:"input-beauty",staticStyle:{width:"90px"},attrs:{type:"number",min:"0.00001",max:"1",step:"0.00001"},domProps:{value:e.form.learning_rate},on:{input:function(t){t.target.composing||e.$set(e.form,"learning_rate",e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}})]),t("div",[t("label",[e._v("val_ratio：")]),t("input",{directives:[{name:"model",rawName:"v-model.number",value:e.form.val_ratio,expression:"form.val_ratio",modifiers:{number:!0}}],staticClass:"input-beauty",staticStyle:{width:"60px"},attrs:{type:"number",min:"0.01",max:"0.99",step:"0.01"},domProps:{value:e.form.val_ratio},on:{input:function(t){t.target.composing||e.$set(e.form,"val_ratio",e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}})])]),t("div",{staticClass:"model-name-row card"},[t("label",{staticClass:"form-label"},[e._v("新模型名：")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.form.new_model_name,expression:"form.new_model_name"}],staticClass:"input-beauty model-name-input",attrs:{placeholder:"仅字母数字下划线",maxlength:"32"},domProps:{value:e.form.new_model_name},on:{input:function(t){t.target.composing||e.$set(e.form,"new_model_name",t.target.value)}}})]),t("div",{staticClass:"form-row card"},[t("button",{staticClass:"train-button gradient-btn",attrs:{disabled:!e.fileName||!e.form.new_model_name||e.isTraining},on:{click:e.startTraining}},[t("i",{staticClass:"fa-solid fa-play"}),e._v(" 开始训练 ")])]),e.isTraining?t("div",{staticClass:"progress-container card progress-card-narrow"},[t("div",{staticClass:"progress-label"},[e._v("训练进度："),t("span",{staticClass:"progress-percent"},[e._v(e._s(e.progress)+"%")])]),t("div",{staticClass:"progress-bar-container"},[t("div",{staticClass:"progress-bar gradient-progress",style:{width:e.progress+"%"}})])]):e._e(),e.epochLogs.length?t("div",{staticClass:"card log-card-narrow"},[t("h3",{staticStyle:{"margin-bottom":"1rem"}},[e._v("训练过程")]),e.epochLogs.length?t("table",{staticClass:"train-log-table"},[e._m(2),t("tbody",e._l(e.epochLogs,(function(s){return t("tr",{key:s.epoch},[t("td",[e._v(e._s(s.epoch))]),t("td",[e._v(e._s(s.train.loss.toFixed(4)))]),t("td",[e._v(e._s((100*s.train.accuracy).toFixed(2))+"%")]),t("td",[e._v(e._s(s.val.loss.toFixed(4)))]),t("td",[e._v(e._s((100*s.val.accuracy).toFixed(2))+"%")]),t("td",[e._v(e._s(s.learning_rate.toExponential(2)))])])})),0)]):e._e()]):e._e(),e.trainingFinished?t("div",{staticClass:"result-section card result-section-beauty"},[t("div",{staticClass:"saved-tip saved-tip-beauty"},[t("i",{staticClass:"fa-solid fa-check-circle"}),t("span",[e._v("模型已自动保存为 "),t("b",[e._v(e._s(e.form.new_model_name)+".pth")]),e._v(" / "),t("b",[e._v(e._s(e.form.new_model_name)+".json")])]),t("button",{staticClass:"cancel-btn",on:{click:e.resetAll}},[e._v("关闭")])])]):e._e(),e.errorMsg?t("div",{staticClass:"error-tip card"},[t("i",{staticClass:"fa-solid fa-exclamation-triangle"}),e._v(" "+e._s(e.errorMsg))]):e._e()])},b=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"header-section card"},[t("h2",{staticClass:"section-title"},[t("i",{staticClass:"fa-solid fa-brain"}),e._v(" 预训练模型训练 ")])])},function(){var e=this,t=e._self._c;return t("label",{staticClass:"file-upload-btn",attrs:{for:"file-upload"}},[t("i",{staticClass:"fa-solid fa-cloud-upload-alt"}),e._v(" 选择文件 ")])},function(){var e=this,t=e._self._c;return t("thead",[t("tr",[t("th",[e._v("Epoch")]),t("th",[e._v("Train Loss")]),t("th",[e._v("Train Acc")]),t("th",[e._v("Val Loss")]),t("th",[e._v("Val Acc")]),t("th",[e._v("LR")])])])}],y={data(){return{modelList:["HybridModel_v1","HyperFusionCortex_v1","MSA_ResGRUNet_protein_classifier","MSA_ResGRUNet_v1","protein_classifier"],selectedModel:"",fileName:"",isTraining:!1,progress:0,trainingFinished:!1,metrics:{accuracy:"--",loss:"--"},fileList:[],errorMsg:"",modelBin:null,modelJson:null,epochLogs:[],form:{max_length:1e4,batch_size:32,epochs:10,learning_rate:1e-4,val_ratio:.2,new_model_name:""}}},methods:{handleFileChange(e){const t=Array.from(e.target.files);this.fileList=t,this.fileName=t.length>0?`已选择${t.length}个文件`:""},async startTraining(){this.isTraining=!0,this.progress=0,this.trainingFinished=!1,this.errorMsg="",this.metrics={accuracy:"--",loss:"--"},this.epochLogs=[];const e=new FormData;this.fileList&&this.fileList.length>0&&this.fileList.forEach(t=>e.append("file",t)),this.selectedModel&&e.append("pretrain_model",this.selectedModel),e.append("model_type",this.selectedModel?this.selectedModel.replace(".pth","").replace("_v1","").replace("_protein_classifier",""):"HybridModel"),e.append("max_length",this.form.max_length),e.append("batch_size",this.form.batch_size),e.append("epochs",this.form.epochs),e.append("learning_rate",this.form.learning_rate),e.append("val_ratio",this.form.val_ratio),e.append("new_model_name",this.form.new_model_name);try{const t=u+"/train_model",s=await fetch(t,{method:"POST",body:e});if(!s.body)throw new Error("No response body");const a=s.body.getReader();let i="",o=!1,l=this.form.epochs;while(!o){const{value:e,done:t}=await a.read();if(o=t,e){i+=(new TextDecoder).decode(e);let t=i.split("\n");i=t.pop();for(let e of t){if(!e.trim())continue;let t;try{t=JSON.parse(e)}catch{continue}if("epoch"===t.type)this.epochLogs.push(t),this.progress=Math.round(t.epoch/l*100);else if("done"===t.type)this.modelBin=t.model_bytes,this.modelJson=t.model_json,this.trainingFinished=!0,t.model_json&&t.model_json.metrics&&(this.metrics={accuracy:t.model_json.metrics.accuracy||"--",loss:t.model_json.metrics.loss||"--"}),this.progress=100,this.isTraining=!1;else if(t.error)return this.errorMsg=t.error,void(this.isTraining=!1)}}}}catch(t){this.errorMsg="训练失败："+t.message,this.isTraining=!1}this.isTraining=!1},downloadModel(){if(!this.modelBin||!this.modelJson)return;const e=new Uint8Array(this.modelBin.match(/.{1,2}/g).map(e=>parseInt(e,16))),t=new Blob([e],{type:"application/octet-stream"}),s=document.createElement("a");s.href=URL.createObjectURL(t),s.download=(this.form.new_model_name||"trained_model")+".pth",s.click();const a=new Blob([JSON.stringify(this.modelJson,null,2)],{type:"application/json"}),i=document.createElement("a");i.href=URL.createObjectURL(a),i.download=(this.form.new_model_name||"trained_model")+".json",i.click()},resetAll(){this.selectedModel="",this.fileName="",this.isTraining=!1,this.progress=0,this.trainingFinished=!1,this.form={max_length:1e4,batch_size:32,epochs:10,learning_rate:1e-4,val_ratio:.2,new_model_name:""},this.errorMsg="",this.modelBin=null,this.modelJson=null,this.epochLogs=[],this.fileList=[]}}},R=y,M=(s("74f8"),Object(d["a"])(R,C,b,!1,null,"c132f6c0",null)),D=M.exports,x=function(){var e=this,t=e._self._c;return t("div",{staticClass:"container"},[t("div",{staticClass:"header-section"},[e._m(0),t("button",{staticClass:"refresh-btn",attrs:{disabled:e.loading},on:{click:e.loadModels}},[t("i",{staticClass:"fa-solid fa-sync",class:{"fa-spin":e.loading}}),e._v(" 刷新 ")])]),t("div",{staticClass:"search-section"},[t("div",{staticClass:"search-container"},[t("i",{staticClass:"fa-solid fa-search search-icon"}),t("input",{directives:[{name:"model",rawName:"v-model",value:e.searchKeyword,expression:"searchKeyword"}],staticClass:"search-input",attrs:{placeholder:"搜索模型..."},domProps:{value:e.searchKeyword},on:{input:function(t){t.target.composing||(e.searchKeyword=t.target.value)}}})]),t("div",{staticClass:"model-count"},[e._v(" 共 "+e._s(e.filteredModels.length)+" 个模型 ")])]),e.loading?t("div",{staticClass:"loading-section"},[t("i",{staticClass:"fa-solid fa-spinner fa-spin"}),e._v(" 加载中... ")]):e._e(),e.error?t("div",{staticClass:"error-section"},[t("i",{staticClass:"fa-solid fa-exclamation-triangle"}),e._v(" "+e._s(e.error)+" ")]):e._e(),e.loading||e.error?e._e():t("div",{staticClass:"model-grid"},[e._l(e.filteredModels,(function(s){return t("div",{key:s.filename,staticClass:"model-card"},[t("div",{staticClass:"model-card-header"},[e._m(1,!0),t("div",{staticClass:"model-info"},[t("h3",{staticClass:"model-name"},[e._v(e._s(s.display_name))]),t("p",{staticClass:"model-type"},[e._v(e._s(s.model_type||"未知类型"))])])]),t("div",{staticClass:"model-card-body"},[t("div",{staticClass:"model-filename"},[t("i",{staticClass:"fa-solid fa-file"}),e._v(" "+e._s(s.filename)+" ")])]),t("div",{staticClass:"model-card-actions"},[t("button",{staticClass:"action-btn view-btn",attrs:{disabled:e.actionLoading[s.filename]},on:{click:function(t){return e.viewModelDetails(s.filename)}}},[t("i",{staticClass:"fa-solid fa-eye"}),e._v(" 详情 ")]),t("button",{staticClass:"action-btn rename-btn",attrs:{disabled:e.actionLoading[s.filename]},on:{click:function(t){return e.showRenameDialog(s)}}},[t("i",{staticClass:"fa-solid fa-edit"}),e._v(" 重命名 ")]),t("button",{staticClass:"action-btn export-btn",attrs:{disabled:e.actionLoading[s.filename]},on:{click:function(t){return e.exportModel(s.filename)}}},[t("i",{staticClass:"fa-solid fa-download"}),e._v(" 导出 ")]),t("button",{staticClass:"action-btn delete-btn",attrs:{disabled:e.actionLoading[s.filename]},on:{click:function(t){return e.showDeleteDialog(s)}}},[t("i",{staticClass:"fa-solid fa-trash"}),e._v(" 删除 ")])]),e.actionLoading[s.filename]?t("div",{staticClass:"action-loading"},[t("i",{staticClass:"fa-solid fa-spinner fa-spin"})]):e._e()])})),0===e.filteredModels.length?t("div",{staticClass:"empty-state"},[t("i",{staticClass:"fa-solid fa-folder-open"}),t("h3",[e._v("没有找到模型")]),e.searchKeyword?t("p",[e._v("尝试修改搜索关键词")]):t("p",[e._v("model文件夹中没有可用的模型文件")])]):e._e()],2),e.showDetailsModal?t("div",{staticClass:"modal-overlay",on:{click:e.closeDetailsModal}},[t("div",{staticClass:"modal-content details-modal",on:{click:function(e){e.stopPropagation()}}},[t("div",{staticClass:"modal-header"},[e._m(2),t("button",{staticClass:"close-btn",on:{click:e.closeDetailsModal}},[t("i",{staticClass:"fa-solid fa-times"})])]),t("div",{staticClass:"modal-body"},[e.selectedModelDetails?t("div",{staticClass:"details-grid"},[t("div",{staticClass:"detail-item"},[t("label",[e._v("文件名:")]),t("span",[e._v(e._s(e.selectedModelDetails.filename))])]),t("div",{staticClass:"detail-item"},[t("label",[e._v("文件大小:")]),t("span",[e._v(e._s(e.selectedModelDetails.file_size))])]),t("div",{staticClass:"detail-item"},[t("label",[e._v("模型类型:")]),t("span",[e._v(e._s(e.selectedModelDetails.model_type))])]),t("div",{staticClass:"detail-item"},[t("label",[e._v("最后修改:")]),t("span",[e._v(e._s(e.formatDate(e.selectedModelDetails.last_modified)))])]),t("div",{staticClass:"detail-item"},[t("label",[e._v("配置文件:")]),t("span",{class:e.selectedModelDetails.config_available?"status-yes":"status-no"},[e._v(" "+e._s(e.selectedModelDetails.config_available?"存在":"缺少")+" ")])]),e.selectedModelDetails.config_available&&e.selectedModelDetails.config_data?t("div",{staticClass:"config-section"},[t("h4",[e._v("配置详情")]),t("div",{staticClass:"config-data"},[t("pre",[e._v(e._s(JSON.stringify(e.selectedModelDetails.config_data,null,2)))])])]):e._e()]):t("div",{staticClass:"loading-details"},[t("i",{staticClass:"fa-solid fa-spinner fa-spin"}),e._v(" 加载详情中... ")])])])]):e._e(),e.showRenameModal?t("div",{staticClass:"modal-overlay",on:{click:e.closeRenameModal}},[t("div",{staticClass:"modal-content rename-modal",on:{click:function(e){e.stopPropagation()}}},[t("div",{staticClass:"modal-header"},[e._m(3),t("button",{staticClass:"close-btn",on:{click:e.closeRenameModal}},[t("i",{staticClass:"fa-solid fa-times"})])]),t("div",{staticClass:"modal-body"},[t("div",{staticClass:"form-group"},[t("label",[e._v("当前名称:")]),t("span",{staticClass:"current-name"},[e._v(e._s(e.selectedModel&&e.selectedModel.filename))])]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"newName"}},[e._v("新名称:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.newModelName,expression:"newModelName"}],staticClass:"rename-input",attrs:{id:"newName",placeholder:"输入新的模型名称"},domProps:{value:e.newModelName},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.confirmRename.apply(null,arguments)},input:function(t){t.target.composing||(e.newModelName=t.target.value)}}}),t("small",{staticClass:"input-hint"},[e._v("名称将自动添加.pth后缀")])])]),t("div",{staticClass:"modal-footer"},[t("button",{staticClass:"btn btn-secondary",on:{click:e.closeRenameModal}},[e._v("取消")]),t("button",{staticClass:"btn btn-primary",attrs:{disabled:!e.newModelName.trim()||e.renaming},on:{click:e.confirmRename}},[e.renaming?t("i",{staticClass:"fa-solid fa-spinner fa-spin"}):e._e(),e._v(" "+e._s(e.renaming?"重命名中...":"确认")+" ")])])])]):e._e(),e.showDeleteModal?t("div",{staticClass:"modal-overlay",on:{click:e.closeDeleteModal}},[t("div",{staticClass:"modal-content delete-modal",on:{click:function(e){e.stopPropagation()}}},[t("div",{staticClass:"modal-header"},[e._m(4),t("button",{staticClass:"close-btn",on:{click:e.closeDeleteModal}},[t("i",{staticClass:"fa-solid fa-times"})])]),t("div",{staticClass:"modal-body"},[t("p",[e._v("确定要删除模型 "),t("strong",[e._v(e._s(e.selectedModel&&e.selectedModel.filename))]),e._v(" 吗？")]),t("p",{staticClass:"warning-text"},[e._v("此操作不可撤销，模型文件和配置文件都会被删除。")])]),t("div",{staticClass:"modal-footer"},[t("button",{staticClass:"btn btn-secondary",on:{click:e.closeDeleteModal}},[e._v("取消")]),t("button",{staticClass:"btn btn-danger",attrs:{disabled:e.deleting},on:{click:e.confirmDelete}},[e.deleting?t("i",{staticClass:"fa-solid fa-spinner fa-spin"}):e._e(),e._v(" "+e._s(e.deleting?"删除中...":"确认删除")+" ")])])])]):e._e(),e.notification.show?t("div",{class:["notification",e.notification.type]},[t("i",{class:e.notificationIcon}),e._v(" "+e._s(e.notification.message)+" ")]):e._e()])},T=[function(){var e=this,t=e._self._c;return t("h2",{staticClass:"section-title"},[t("i",{staticClass:"fa-solid fa-database"}),e._v(" 模型管理 ")])},function(){var e=this,t=e._self._c;return t("div",{staticClass:"model-icon"},[t("i",{staticClass:"fa-solid fa-brain"})])},function(){var e=this,t=e._self._c;return t("h3",[t("i",{staticClass:"fa-solid fa-info-circle"}),e._v(" 模型详情")])},function(){var e=this,t=e._self._c;return t("h3",[t("i",{staticClass:"fa-solid fa-edit"}),e._v(" 重命名模型")])},function(){var e=this,t=e._self._c;return t("h3",[t("i",{staticClass:"fa-solid fa-exclamation-triangle text-danger"}),e._v(" 删除模型")])}],k={data(){return{searchKeyword:"",models:[],loading:!1,error:null,actionLoading:{},showDetailsModal:!1,showRenameModal:!1,showDeleteModal:!1,selectedModel:null,selectedModelDetails:null,newModelName:"",renaming:!1,deleting:!1,notification:{show:!1,message:"",type:"success"}}},computed:{filteredModels(){if(!this.searchKeyword.trim())return this.models;const e=this.searchKeyword.toLowerCase().trim();return this.models.filter(t=>t.filename.toLowerCase().includes(e)||t.display_name.toLowerCase().includes(e)||t.model_type&&t.model_type.toLowerCase().includes(e))},notificationIcon(){const e={success:"fa-solid fa-check-circle",error:"fa-solid fa-exclamation-circle",warning:"fa-solid fa-exclamation-triangle"};return e[this.notification.type]||e.success}},mounted(){this.loadModels()},methods:{async loadModels(){this.loading=!0,this.error=null;try{const e=await fetch(u+"/models");if(!e.ok)throw new Error(`HTTP ${e.status}: ${e.statusText}`);const t=await e.json();this.models=t.models||[],this.actionLoading={}}catch(e){console.error("加载模型列表失败:",e),this.error=e.message||"加载模型列表失败",this.models=[]}finally{this.loading=!1}},async viewModelDetails(e){this.setActionLoading(e,!0);try{const t=await fetch(`${u}/models/${e}/details`);if(!t.ok)throw new Error("获取模型详情失败: "+t.statusText);this.selectedModelDetails=await t.json(),this.showDetailsModal=!0}catch(t){console.error("获取模型详情失败:",t),this.showNotification("获取模型详情失败: "+t.message,"error")}finally{this.setActionLoading(e,!1)}},showRenameDialog(e){this.selectedModel=e,this.newModelName=e.filename.replace(".pth",""),this.showRenameModal=!0},async confirmRename(){if(this.newModelName.trim()&&!this.renaming){this.renaming=!0;try{const e=await fetch(`${u}/models/${this.selectedModel.filename}/rename`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({new_name:this.newModelName.trim()})});if(!e.ok){const t=await e.json();throw new Error(t.error||"重命名失败")}this.showNotification("模型重命名成功","success"),this.closeRenameModal(),this.loadModels()}catch(e){console.error("重命名模型失败:",e),this.showNotification("重命名失败: "+e.message,"error")}finally{this.renaming=!1}}},showDeleteDialog(e){this.selectedModel=e,this.showDeleteModal=!0},async confirmDelete(){if(!this.deleting){this.deleting=!0;try{const e=await fetch(`${u}/models/${this.selectedModel.filename}`,{method:"DELETE"});if(!e.ok){const t=await e.json();throw new Error(t.error||"删除失败")}this.showNotification("模型删除成功","success"),this.closeDeleteModal(),this.loadModels()}catch(e){console.error("删除模型失败:",e),this.showNotification("删除失败: "+e.message,"error")}finally{this.deleting=!1}}},async exportModel(e){this.setActionLoading(e,!0);try{const t=await fetch(`${u}/models/${e}/export`);if(!t.ok)throw new Error("导出失败: "+t.statusText);const s=t.headers.get("content-disposition");let a=e;if(s&&-1!==s.indexOf("filename=")){const t=s.split("filename=")[1];a=t?t.replace(/"/g,""):e}const i=await t.blob(),o=window.URL.createObjectURL(i),l=document.createElement("a");l.href=o,l.download=a,document.body.appendChild(l),l.click(),document.body.removeChild(l),window.URL.revokeObjectURL(o),this.showNotification("模型导出成功","success")}catch(t){console.error("导出模型失败:",t),this.showNotification("导出失败: "+t.message,"error")}finally{this.setActionLoading(e,!1)}},setActionLoading(e,t){this.$set(this.actionLoading,e,t)},closeDetailsModal(){this.showDetailsModal=!1,this.selectedModelDetails=null},closeRenameModal(){this.showRenameModal=!1,this.selectedModel=null,this.newModelName="",this.renaming=!1},closeDeleteModal(){this.showDeleteModal=!1,this.selectedModel=null,this.deleting=!1},showNotification(e,t="success"){this.notification={show:!0,message:e,type:t},setTimeout(()=>{this.notification.show=!1},3e3)},formatDate(e){if(!e)return"未知";const t=new Date(1e3*e);return t.toLocaleString("zh-CN")}}},L=k,N=(s("a2df"),Object(d["a"])(L,x,T,!1,null,"70392694",null)),F=N.exports,S={data(){return{currentPage:"GeneVisualization"}},methods:{showPage(e){this.currentPage=e}},components:{GeneVisualization:f,SummaryReport:w,ModelTrain:D,ModelManage:F}},$=S,P=(s("efde"),Object(d["a"])($,i,o,!1,null,"a7483a70",null)),E=P.exports;a["a"].config.productionTip=!1,new a["a"]({render:e=>e(E)}).$mount("#app")},"58f2":function(e,t,s){},"70a3":function(e,t,s){},"74f8":function(e,t,s){"use strict";s("b71d")},a2df:function(e,t,s){"use strict";s("b32e")},b32e:function(e,t,s){},b5d1:function(e,t,s){"use strict";s("d70e")},b71d:function(e,t,s){},d70e:function(e,t,s){},e33e:function(e,t,s){"use strict";s("58f2")},efde:function(e,t,s){"use strict";s("70a3")}});
//# sourceMappingURL=app.e8ef001d.js.map